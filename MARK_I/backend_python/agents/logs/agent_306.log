[AGENT] File logging enabled: C:\Users\y.djemai\pam-testdrive\MARK_I\backend_python\agents\logs\agent_306.log
[DB_CLIENT DEBUG] SUPABASE_URL: https://ioddvuvaxqywbzfcjmpi.supabase.co
[DB_CLIENT DEBUG] SUPABASE_ANON_KEY: SET
[DB_CLIENT DEBUG] SUPABASE_SERVICE_ROLE_KEY: SET
[DB_CLIENT DEBUG] Creating Supabase service client with URL: https://ioddvuvaxqywbzfcjmpi.supabase.co
[DB_CLIENT DEBUG] Supabase service client created successfully!
[DB_CLIENT DEBUG] SUPABASE_URL: https://ioddvuvaxqywbzfcjmpi.supabase.co
[DB_CLIENT DEBUG] SUPABASE_ANON_KEY: SET
[DB_CLIENT DEBUG] SUPABASE_SERVICE_ROLE_KEY: SET
[DB_CLIENT DEBUG] Creating Supabase service client with URL: https://ioddvuvaxqywbzfcjmpi.supabase.co
[DB_CLIENT DEBUG] Supabase service client created successfully!
{"message": "starting worker", "level": "INFO", "name": "livekit.agents", "version": "1.1.6", "rtc-version": "1.0.11", "timestamp": "2025-07-23T19:20:06.553986+00:00"}
{"message": "initializing job runner", "level": "INFO", "name": "livekit.agents", "tid": 28584, "timestamp": "2025-07-23T19:20:06.598322+00:00"}
{"message": "initializing job runner", "level": "INFO", "name": "livekit.agents", "tid": 41000, "timestamp": "2025-07-23T19:20:06.599044+00:00"}
{"message": "initializing job runner", "level": "INFO", "name": "livekit.agents", "tid": 32896, "timestamp": "2025-07-23T19:20:06.599044+00:00"}
{"message": "initializing job runner", "level": "INFO", "name": "livekit.agents", "tid": 10412, "timestamp": "2025-07-23T19:20:06.599044+00:00"}
{"message": "initializing job runner", "level": "INFO", "name": "livekit.agents", "tid": 20616, "timestamp": "2025-07-23T19:20:06.599044+00:00"}
{"message": "initializing job runner", "level": "INFO", "name": "livekit.agents", "tid": 42908, "timestamp": "2025-07-23T19:20:06.599044+00:00"}
{"message": "initializing job runner", "level": "INFO", "name": "livekit.agents", "tid": 4008, "timestamp": "2025-07-23T19:20:06.599044+00:00"}
{"message": "initializing job runner", "level": "INFO", "name": "livekit.agents", "tid": 37656, "timestamp": "2025-07-23T19:20:06.599044+00:00"}
{"message": "initializing job runner", "level": "INFO", "name": "livekit.agents", "tid": 26944, "timestamp": "2025-07-23T19:20:06.599044+00:00"}
{"message": "initializing job runner", "level": "INFO", "name": "livekit.agents", "tid": 30108, "timestamp": "2025-07-23T19:20:06.606762+00:00"}
{"message": "initializing job runner", "level": "INFO", "name": "livekit.agents", "tid": 14680, "timestamp": "2025-07-23T19:20:06.608785+00:00"}
{"message": "initializing job runner", "level": "INFO", "name": "livekit.agents", "tid": 2456, "timestamp": "2025-07-23T19:20:06.609337+00:00"}
{"message": "job runner initialized", "level": "INFO", "name": "livekit.agents", "tid": 28584, "elapsed_time": 0.04, "timestamp": "2025-07-23T19:20:06.640402+00:00"}
{"message": "job runner initialized", "level": "INFO", "name": "livekit.agents", "tid": 41000, "elapsed_time": 0.04, "timestamp": "2025-07-23T19:20:06.640402+00:00"}
{"message": "job runner initialized", "level": "INFO", "name": "livekit.agents", "tid": 32896, "elapsed_time": 0.04, "timestamp": "2025-07-23T19:20:06.640402+00:00"}
{"message": "job runner initialized", "level": "INFO", "name": "livekit.agents", "tid": 10412, "elapsed_time": 0.04, "timestamp": "2025-07-23T19:20:06.640402+00:00"}
{"message": "job runner initialized", "level": "INFO", "name": "livekit.agents", "tid": 20616, "elapsed_time": 0.04, "timestamp": "2025-07-23T19:20:06.640402+00:00"}
{"message": "job runner initialized", "level": "INFO", "name": "livekit.agents", "tid": 42908, "elapsed_time": 0.04, "timestamp": "2025-07-23T19:20:06.640402+00:00"}
{"message": "job runner initialized", "level": "INFO", "name": "livekit.agents", "tid": 4008, "elapsed_time": 0.04, "timestamp": "2025-07-23T19:20:06.640402+00:00"}
{"message": "job runner initialized", "level": "INFO", "name": "livekit.agents", "tid": 37656, "elapsed_time": 0.04, "timestamp": "2025-07-23T19:20:06.640402+00:00"}
{"message": "job runner initialized", "level": "INFO", "name": "livekit.agents", "tid": 30108, "elapsed_time": 0.04, "timestamp": "2025-07-23T19:20:06.640402+00:00"}
{"message": "job runner initialized", "level": "INFO", "name": "livekit.agents", "tid": 26944, "elapsed_time": 0.04, "timestamp": "2025-07-23T19:20:06.640402+00:00"}
{"message": "job runner initialized", "level": "INFO", "name": "livekit.agents", "tid": 14680, "elapsed_time": 0.04, "timestamp": "2025-07-23T19:20:06.640402+00:00"}
{"message": "job runner initialized", "level": "INFO", "name": "livekit.agents", "tid": 2456, "elapsed_time": 0.04, "timestamp": "2025-07-23T19:20:06.640402+00:00"}
{"message": "see tracing information at http://localhost:58966/debug", "level": "INFO", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:06.640402+00:00"}
{"message": "registered worker", "level": "INFO", "name": "livekit.agents", "id": "AW_HVeLtvWWAw9s", "url": "wss://pamtestdrive-euxn3osq.livekit.cloud", "region": "Germany", "protocol": 16, "timestamp": "2025-07-23T19:20:06.771787+00:00"}
{"message": "received job request", "level": "INFO", "name": "livekit.agents", "job_id": "AJ_odtKTUFepwWP", "dispatch_id": "", "room_name": "agent-call-307", "agent_name": "outbound-caller", "resuming": false, "timestamp": "2025-07-23T19:20:15.602166+00:00"}
{"message": "Entrée dans la fonction entrypoint pour le job AJ_odtKTUFepwWP", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:15.621139+00:00"}
{"message": "initializing job runner", "level": "INFO", "name": "livekit.agents", "tid": 42276, "timestamp": "2025-07-23T19:20:15.699533+00:00"}
{"message": "job runner initialized", "level": "INFO", "name": "livekit.agents", "tid": 42276, "elapsed_time": 0.0, "timestamp": "2025-07-23T19:20:15.702536+00:00"}
{"message": "Connexion établie à la room agent-call-307", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.248457+00:00"}
{"message": "Métadonnées brutes du job: {\"firstName\": \"Valued Customer\", \"lastName\": \"\", \"dial_info\": {\"agent_id\": 11, \"call_direction\": \"outbound\", \"room_name\": \"agent-call-307\", \"supabase_call_id\": 307, \"telnyx_call_control_id\": null, \"default_pathway_id\": \"d5fc510b-7635-4715-9066-e522daa2336d\", \"user_id\": \"b55837c4-270f-4f1f-8023-7ab09ee5f44d\", \"auth_token\": null, \"phone_number\": \"+33661329235\", \"sip_trunk_id\": \"ST_6CYLZwTLMCe2\", \"agent_caller_id_number\": \"+33189311209\"}, \"system_prompt\": null, \"initial_greeting\": null, \"wait_for_greeting\": false, \"pam_tier\": \"core\", \"interruption_threshold\": 100, \"ai_models\": {\"vad\": {\"provider\": \"silero\"}, \"stt\": {\"provider\": \"deepgram\", \"language\": \"en\", \"model\": \"nova-2\"}, \"tts\": {\"provider\": \"cartesia\", \"model\": \"sonic-2\", \"voice_id\": \"f9836c6e-a0bd-460e-9d3c-f7299fa60f94\"}, \"llm\": {\"provider\": \"openai\", \"model\": \"gpt-4o-mini\"}}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.249453+00:00"}
{"message": "Métadonnées parsées: {'firstName': 'Valued Customer', 'lastName': '', 'dial_info': {'agent_id': 11, 'call_direction': 'outbound', 'room_name': 'agent-call-307', 'supabase_call_id': 307, 'telnyx_call_control_id': None, 'default_pathway_id': 'd5fc510b-7635-4715-9066-e522daa2336d', 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'auth_token': None, 'phone_number': '+33661329235', 'sip_trunk_id': 'ST_6CYLZwTLMCe2', 'agent_caller_id_number': '+33189311209'}, 'system_prompt': None, 'initial_greeting': None, 'wait_for_greeting': False, 'pam_tier': 'core', 'interruption_threshold': 100, 'ai_models': {'vad': {'provider': 'silero'}, 'stt': {'provider': 'deepgram', 'language': 'en', 'model': 'nova-2'}, 'tts': {'provider': 'cartesia', 'model': 'sonic-2', 'voice_id': 'f9836c6e-a0bd-460e-9d3c-f7299fa60f94'}, 'llm': {'provider': 'openai', 'model': 'gpt-4o-mini'}}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.250453+00:00"}
{"message": "supabase_call_id extrait des métadonnées: 307", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.250967+00:00"}
{"message": "Métadonnées du job: {\"firstName\": \"Valued Customer\", \"lastName\": \"\", \"dial_info\": {\"agent_id\": 11, \"call_direction\": \"outbound\", \"room_name\": \"agent-call-307\", \"supabase_call_id\": 307, \"telnyx_call_control_id\": null, \"default_pathway_id\": \"d5fc510b-7635-4715-9066-e522daa2336d\", \"user_id\": \"b55837c4-270f-4f1f-8023-7ab09ee5f44d\", \"auth_token\": null, \"phone_number\": \"+33661329235\", \"sip_trunk_id\": \"ST_6CYLZwTLMCe2\", \"agent_caller_id_number\": \"+33189311209\"}, \"system_prompt\": null, \"initial_greeting\": null, \"wait_for_greeting\": false, \"pam_tier\": \"core\", \"interruption_threshold\": 100, \"ai_models\": {\"vad\": {\"provider\": \"silero\"}, \"stt\": {\"provider\": \"deepgram\", \"language\": \"en\", \"model\": \"nova-2\"}, \"tts\": {\"provider\": \"cartesia\", \"model\": \"sonic-2\", \"voice_id\": \"f9836c6e-a0bd-460e-9d3c-f7299fa60f94\"}, \"llm\": {\"provider\": \"openai\", \"model\": \"gpt-4o-mini\"}}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.253039+00:00"}
{"message": "dial_info parsed from metadata: {'firstName': 'Valued Customer', 'lastName': '', 'dial_info': {'agent_id': 11, 'call_direction': 'outbound', 'room_name': 'agent-call-307', 'supabase_call_id': 307, 'telnyx_call_control_id': None, 'default_pathway_id': 'd5fc510b-7635-4715-9066-e522daa2336d', 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'auth_token': None, 'phone_number': '+33661329235', 'sip_trunk_id': 'ST_6CYLZwTLMCe2', 'agent_caller_id_number': '+33189311209'}, 'system_prompt': None, 'initial_greeting': None, 'wait_for_greeting': False, 'pam_tier': 'core', 'interruption_threshold': 100, 'ai_models': {'vad': {'provider': 'silero'}, 'stt': {'provider': 'deepgram', 'language': 'en', 'model': 'nova-2'}, 'tts': {'provider': 'cartesia', 'model': 'sonic-2', 'voice_id': 'f9836c6e-a0bd-460e-9d3c-f7299fa60f94'}, 'llm': {'provider': 'openai', 'model': 'gpt-4o-mini'}}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.253039+00:00"}
{"message": "Using firstName from metadata or default: Valued Customer", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.254034+00:00"}
{"message": "OUTBOUND CALL: To +33661329235", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.255047+00:00"}
{"message": "Default pathway found for agent: d5fc510b-7635-4715-9066-e522daa2336d", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.255047+00:00"}
{"message": "Agent ID from metadata: 11", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.256037+00:00"}
{"message": "User ID from metadata: b55837c4-270f-4f1f-8023-7ab09ee5f44d", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.256037+00:00"}
{"message": "System prompt is null - using WorkflowAgent with pathway-specific prompts", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.257070+00:00"}
{"message": "PAM Tier: core, Wait for Greeting: False, Interruption Threshold: 100ms", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.257070+00:00"}
{"message": "DEBUG: Full dial_info structure: {'firstName': 'Valued Customer', 'lastName': '', 'dial_info': {'agent_id': 11, 'call_direction': 'outbound', 'room_name': 'agent-call-307', 'supabase_call_id': 307, 'telnyx_call_control_id': None, 'default_pathway_id': 'd5fc510b-7635-4715-9066-e522daa2336d', 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'auth_token': None, 'phone_number': '+33661329235', 'sip_trunk_id': 'ST_6CYLZwTLMCe2', 'agent_caller_id_number': '+33189311209'}, 'system_prompt': None, 'initial_greeting': None, 'wait_for_greeting': False, 'pam_tier': 'core', 'interruption_threshold': 100, 'ai_models': {'vad': {'provider': 'silero'}, 'stt': {'provider': 'deepgram', 'language': 'en', 'model': 'nova-2'}, 'tts': {'provider': 'cartesia', 'model': 'sonic-2', 'voice_id': 'f9836c6e-a0bd-460e-9d3c-f7299fa60f94'}, 'llm': {'provider': 'openai', 'model': 'gpt-4o-mini'}}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.258038+00:00"}
{"message": "DEBUG: dial_info.get('dial_info'): {'agent_id': 11, 'call_direction': 'outbound', 'room_name': 'agent-call-307', 'supabase_call_id': 307, 'telnyx_call_control_id': None, 'default_pathway_id': 'd5fc510b-7635-4715-9066-e522daa2336d', 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'auth_token': None, 'phone_number': '+33661329235', 'sip_trunk_id': 'ST_6CYLZwTLMCe2', 'agent_caller_id_number': '+33189311209'}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.258038+00:00"}
{"message": "DEBUG: Extracted agent_caller_id_number: +33189311209", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.259041+00:00"}
{"message": "Agent Caller ID (agent_caller_id_number) found in job metadata: +33189311209", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.260037+00:00"}
{"message": "Utilisation du SIP Trunk ID des métadonnées: ST_6CYLZwTLMCe2", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.260037+00:00"}
{"message": "Utilisation du prompt système formaté depuis les métadonnées.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.260037+00:00"}
{"message": "Final dial info for agent: {'firstName': 'Valued Customer', 'lastName': '', 'dial_info': {'agent_id': 11, 'call_direction': 'outbound', 'room_name': 'agent-call-307', 'supabase_call_id': 307, 'telnyx_call_control_id': None, 'default_pathway_id': 'd5fc510b-7635-4715-9066-e522daa2336d', 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'auth_token': None, 'phone_number': '+33661329235', 'sip_trunk_id': 'ST_6CYLZwTLMCe2', 'agent_caller_id_number': '+33189311209'}, 'system_prompt': None, 'initial_greeting': None, 'wait_for_greeting': False, 'pam_tier': 'core', 'interruption_threshold': 100, 'ai_models': {'vad': {'provider': 'silero'}, 'stt': {'provider': 'deepgram', 'language': 'en', 'model': 'nova-2'}, 'tts': {'provider': 'cartesia', 'model': 'sonic-2', 'voice_id': 'f9836c6e-a0bd-460e-9d3c-f7299fa60f94'}, 'llm': {'provider': 'openai', 'model': 'gpt-4o-mini'}}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.261002+00:00"}
{"message": "Agent will use name: Valued Customer", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.261002+00:00"}
{"message": "Dialing number: +33661329235", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.262041+00:00"}
{"message": "Configuration IA chargée depuis les métadonnées: {'vad': {'provider': 'silero'}, 'stt': {'provider': 'deepgram', 'language': 'en', 'model': 'nova-2'}, 'tts': {'provider': 'cartesia', 'model': 'sonic-2', 'voice_id': 'f9836c6e-a0bd-460e-9d3c-f7299fa60f94'}, 'llm': {'provider': 'openai', 'model': 'gpt-4o-mini'}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.263038+00:00"}
{"message": "Plugin VAD Silero chargé.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.749784+00:00"}
{"message": "Plugin STT Deepgram chargé (lang: en, model: nova-2).", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.753805+00:00"}
{"message": "Plugin TTS Cartesia chargé (model: sonic-2, voice: f9836c6e-a0bd-460e-9d3c-f7299fa60f94).", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:16.762515+00:00"}
{"message": "Plugin LLM OpenAI chargé (model: gpt-4o-mini).", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:17.935976+00:00"}
{"message": "Instantiating AgentSession with dynamically loaded plugins.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:19.288227+00:00"}
{"message": "AgentSession created successfully with dynamic plugins.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:19.289223+00:00"}
{"message": "OUTBOUND CALL: Attempting SIP dial to +33661329235 via trunk ST_6CYLZwTLMCe2 pour Supabase ID: 307", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:19.289223+00:00"}
{"message": "Préparation de l'en-tête SIP X-Client-State avec valeur (encodée): MzA3", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:19.289223+00:00"}
{"message": "Tentative de mise à jour des infos pour room agent-call-307 (Supabase ID: 307) avec payload: {'new_status': 'dialing', 'supabase_call_id': '307'} via backend: http://localhost:8000/calls/room/agent-call-307/status", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:19.291865+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 3.83 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:20.073081+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 3.83 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:20.073081+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 3.83 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:20.073081+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 3.83 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:20.074078+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 3.83 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:20.074078+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 3.83 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:20.074078+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 3.83 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:20.074078+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 3.83 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:20.074078+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 3.83 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:20.074078+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 3.83 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:20.075018+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 3.83 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:20.075018+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 3.83 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:20.075018+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 3.83 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:20.075018+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 3.83 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:20:20.075018+00:00"}
{"message": "Infos mises à jour avec succès pour room agent-call-307 (Supabase ID: 307): {'message': 'Call status updated successfully', 'call': {'id': 307, 'created_at': '2025-07-23T19:20:10.541042+00:00', 'updated_at': '2025-07-23T19:20:20.411794+00:00', 'agent_id': 11, 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'to_phone_number': '+33661329235', 'status': 'dialing', 'initiated_at': None, 'answered_at': None, 'ended_at': None, 'call_duration': None, 'from_phone_number': None, 'ended_reason': None, 'livekit_room_name': None, 'livekit_participant_identity': None, 'provider': None, 'livekit_outbound_trunk_id': None, 'call_control_id': None, 'agent_name': None, 'telnyx_call_session_id': None, 'batch_campaign_id': None, 'batch_call_item_id': None, 'call_type': 'outbound', 'phone_number_e164': '+33661329235', 'contact_name': None, 'room_name': 'agent-call-307', 'pathway_execution_id': None, 'current_pathway_node_id': None, 'pathway_variables': None, 'call_direction': 'outbound', 'caller_number': None, 'agent_process_pid': 32600, 'error_message': None, 'duration_seconds': None}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:20.380327+00:00"}
{"message": "Appel à ctx.api.sip.create_sip_participant avec phoneNumber: +33661329235, trunk: ST_6CYLZwTLMCe2, from: +33189311209, metadata: {\"supabase_call_id\": \"307\"}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:20.381321+00:00"}
{"message": "SIP call created for +33661329235. Waiting for SIP participant to join room.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:21.004635+00:00"}
{"message": "SIP participant 'agent_sip_participant_+33661329235' (PA_a5hZ889juvWY) connected to room agent-call-307.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:21.004635+00:00"}
{"message": "Tentative de mise à jour des infos pour room agent-call-307 (Supabase ID: 307) avec payload: {'new_status': 'connected', 'supabase_call_id': '307'} via backend: http://localhost:8000/calls/room/agent-call-307/status", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:21.005633+00:00"}
{"message": "Infos mises à jour avec succès pour room agent-call-307 (Supabase ID: 307): {'message': 'Call status updated successfully', 'call': {'id': 307, 'created_at': '2025-07-23T19:20:10.541042+00:00', 'updated_at': '2025-07-23T19:20:21.74583+00:00', 'agent_id': 11, 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'to_phone_number': '+33661329235', 'status': 'connected', 'initiated_at': None, 'answered_at': None, 'ended_at': None, 'call_duration': None, 'from_phone_number': None, 'ended_reason': None, 'livekit_room_name': None, 'livekit_participant_identity': None, 'provider': None, 'livekit_outbound_trunk_id': None, 'call_control_id': None, 'agent_name': None, 'telnyx_call_session_id': None, 'batch_campaign_id': None, 'batch_call_item_id': None, 'call_type': 'outbound', 'phone_number_e164': '+33661329235', 'contact_name': None, 'room_name': 'agent-call-307', 'pathway_execution_id': None, 'current_pathway_node_id': None, 'pathway_variables': None, 'call_direction': 'outbound', 'caller_number': None, 'agent_process_pid': 32600, 'error_message': None, 'duration_seconds': None}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:21.715596+00:00"}
{"message": "Call connected (OUTBOUND), participant joined. Starting agent session for supabase_call_id: 307", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:21.716122+00:00"}
{"message": "run_session_safely: AVANT appel à session.start() pour supabase_call_id: 307 (UTILISATION DE ConversationAgent - OUTBOUND CALL)", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:21.717130+00:00"}
{"message": "Auto-starting pathway execution: pathway_id=d5fc510b-7635-4715-9066-e522daa2336d, agent_id=11, call_id=307", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:21.741447+00:00"}
{"message": "Checking for default pathway for agent 11 and call 307", "level": "INFO", "name": "agent_pathway_integration", "timestamp": "2025-07-23T19:20:21.743296+00:00"}
{"message": "Created pathway execution record: 9f4924e7-8237-423c-b1d1-82fce7e2b067", "level": "INFO", "name": "agent_pathway_integration", "timestamp": "2025-07-23T19:20:22.418374+00:00"}
{"message": "Linked call 307 to pathway execution 9f4924e7-8237-423c-b1d1-82fce7e2b067", "level": "INFO", "name": "agent_pathway_integration", "timestamp": "2025-07-23T19:20:22.465639+00:00"}
{"message": "Pathway execution started successfully: 9f4924e7-8237-423c-b1d1-82fce7e2b067", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:22.471806+00:00"}
{"message": "run_session_safely: APRÈS appel à session.start() pour supabase_call_id: 307 (OUTBOUND CALL). La session devrait avoir démarré et exécuté la logique de l'agent.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:22.509077+00:00"}
{"message": "Agent session task finished normally for outbound call supabase_call_id: 307.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:22.513292+00:00"}
{"message": "Fin du job pour la room agent-call-307 (OUTBOUND call, Supabase ID: 307). Statut final de session: completed", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:22.514289+00:00"}
{"message": "TELNYX_API_KEY ou call_control_id manquant pour récupérer la durée réelle d'appel.", "level": "WARNING", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:22.515326+00:00"}
{"message": "Tentative de mise à jour des infos pour room agent-call-307 (Supabase ID: 307) avec payload: {'new_status': 'completed', 'supabase_call_id': '307', 'call_duration_seconds': 1} via backend: http://localhost:8000/calls/room/agent-call-307/status", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:22.515326+00:00"}
{"message": "Infos mises à jour avec succès pour room agent-call-307 (Supabase ID: 307): {'message': 'Call status updated successfully', 'call': {'id': 307, 'created_at': '2025-07-23T19:20:10.541042+00:00', 'updated_at': '2025-07-23T19:20:23.568931+00:00', 'agent_id': 11, 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'to_phone_number': '+33661329235', 'status': 'completed', 'initiated_at': None, 'answered_at': None, 'ended_at': '2025-07-23T19:20:23.495278+00:00', 'call_duration': None, 'from_phone_number': None, 'ended_reason': None, 'livekit_room_name': None, 'livekit_participant_identity': None, 'provider': None, 'livekit_outbound_trunk_id': None, 'call_control_id': None, 'agent_name': None, 'telnyx_call_session_id': None, 'batch_campaign_id': None, 'batch_call_item_id': None, 'call_type': 'outbound', 'phone_number_e164': '+33661329235', 'contact_name': None, 'room_name': 'agent-call-307', 'pathway_execution_id': '9f4924e7-8237-423c-b1d1-82fce7e2b067', 'current_pathway_node_id': 'conversation-1752584446694', 'pathway_variables': None, 'call_direction': 'outbound', 'caller_number': None, 'agent_process_pid': 32600, 'error_message': None, 'duration_seconds': 1}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:23.541327+00:00"}
{"message": "Session task awaited and completed for supabase_call_id 307.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:23.542328+00:00"}
{"message": "Setting up to wait for participant 'agent_sip_participant_+33661329235' to disconnect as a final check...", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:23.543327+00:00"}
{"message": "Now waiting for participant 'agent_sip_participant_+33661329235' to disconnect (final check)...", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:20:23.543327+00:00"}
{"message": "error running user callback for participant_disconnected: room_handle: 3\nparticipant_disconnected {\n  participant_identity: \"agent_sip_participant_+33661329235\"\n  disconnect_reason: CLIENT_INITIATED\n}\n", "level": "ERROR", "name": "root", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\rtc\\room.py\", line 560, in _listen_task\n    self._on_room_event(event.room_event)\n  File \"C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\rtc\\room.py\", line 604, in _on_room_event\n    self.emit(\"participant_disconnected\", rparticipant)\n  File \"C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\rtc\\event_emitter.py\", line 58, in emit\n    callback(*callback_args)\nTypeError: entrypoint.<locals>.on_participant_disconnected_callback() missing 1 required positional argument: 'room'", "timestamp": "2025-07-23T19:20:27.521924+00:00"}
{"message": "closing agent session due to participant disconnect (disable via `RoomInputOptions.close_on_disconnect=False`)", "level": "INFO", "name": "livekit.agents", "participant": "agent_sip_participant_+33661329235", "reason": "CLIENT_INITIATED", "timestamp": "2025-07-23T19:20:27.535299+00:00"}
{"message": "Task exception was never retrieved\nfuture: <Task finished name='AgentTask_on_exit' coro=<BasePathwayAgent.on_exit() done, defined at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\pathway_global_context.py:472> exception=ValueError('VoiceAgent userdata is not set')>", "level": "ERROR", "name": "asyncio", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\pathway_global_context.py\", line 477, in on_exit\n    if self.session and hasattr(self.session, 'userdata'):\n                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\voice\\agent_session.py\", line 264, in userdata\n    raise ValueError(\"VoiceAgent userdata is not set\")\nValueError: VoiceAgent userdata is not set", "timestamp": "2025-07-23T19:20:27.544399+00:00"}
{"message": "received job request", "level": "INFO", "name": "livekit.agents", "job_id": "AJ_CJxfbWfNa8kp", "dispatch_id": "", "room_name": "agent-call-309", "agent_name": "outbound-caller", "resuming": false, "timestamp": "2025-07-23T19:22:44.709650+00:00"}
{"message": "Entrée dans la fonction entrypoint pour le job AJ_CJxfbWfNa8kp", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:44.730874+00:00"}
{"message": "initializing job runner", "level": "INFO", "name": "livekit.agents", "tid": 21576, "timestamp": "2025-07-23T19:22:44.755612+00:00"}
{"message": "job runner initialized", "level": "INFO", "name": "livekit.agents", "tid": 21576, "elapsed_time": 0.0, "timestamp": "2025-07-23T19:22:44.755612+00:00"}
{"message": "Connexion établie à la room agent-call-309", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.260828+00:00"}
{"message": "Métadonnées brutes du job: {\"firstName\": \"Valued Customer\", \"lastName\": \"\", \"dial_info\": {\"agent_id\": 11, \"call_direction\": \"outbound\", \"room_name\": \"agent-call-309\", \"supabase_call_id\": 309, \"telnyx_call_control_id\": null, \"default_pathway_id\": \"d5fc510b-7635-4715-9066-e522daa2336d\", \"user_id\": \"b55837c4-270f-4f1f-8023-7ab09ee5f44d\", \"auth_token\": null, \"phone_number\": \"+33661329235\", \"sip_trunk_id\": \"ST_6CYLZwTLMCe2\", \"agent_caller_id_number\": \"+33189311209\"}, \"system_prompt\": null, \"initial_greeting\": null, \"wait_for_greeting\": false, \"pam_tier\": \"core\", \"interruption_threshold\": 100, \"ai_models\": {\"vad\": {\"provider\": \"silero\"}, \"stt\": {\"provider\": \"deepgram\", \"language\": \"en\", \"model\": \"nova-2\"}, \"tts\": {\"provider\": \"cartesia\", \"model\": \"sonic-2\", \"voice_id\": \"f9836c6e-a0bd-460e-9d3c-f7299fa60f94\"}, \"llm\": {\"provider\": \"openai\", \"model\": \"gpt-4o-mini\"}}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.260828+00:00"}
{"message": "Métadonnées parsées: {'firstName': 'Valued Customer', 'lastName': '', 'dial_info': {'agent_id': 11, 'call_direction': 'outbound', 'room_name': 'agent-call-309', 'supabase_call_id': 309, 'telnyx_call_control_id': None, 'default_pathway_id': 'd5fc510b-7635-4715-9066-e522daa2336d', 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'auth_token': None, 'phone_number': '+33661329235', 'sip_trunk_id': 'ST_6CYLZwTLMCe2', 'agent_caller_id_number': '+33189311209'}, 'system_prompt': None, 'initial_greeting': None, 'wait_for_greeting': False, 'pam_tier': 'core', 'interruption_threshold': 100, 'ai_models': {'vad': {'provider': 'silero'}, 'stt': {'provider': 'deepgram', 'language': 'en', 'model': 'nova-2'}, 'tts': {'provider': 'cartesia', 'model': 'sonic-2', 'voice_id': 'f9836c6e-a0bd-460e-9d3c-f7299fa60f94'}, 'llm': {'provider': 'openai', 'model': 'gpt-4o-mini'}}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.267400+00:00"}
{"message": "supabase_call_id extrait des métadonnées: 309", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.267400+00:00"}
{"message": "Métadonnées du job: {\"firstName\": \"Valued Customer\", \"lastName\": \"\", \"dial_info\": {\"agent_id\": 11, \"call_direction\": \"outbound\", \"room_name\": \"agent-call-309\", \"supabase_call_id\": 309, \"telnyx_call_control_id\": null, \"default_pathway_id\": \"d5fc510b-7635-4715-9066-e522daa2336d\", \"user_id\": \"b55837c4-270f-4f1f-8023-7ab09ee5f44d\", \"auth_token\": null, \"phone_number\": \"+33661329235\", \"sip_trunk_id\": \"ST_6CYLZwTLMCe2\", \"agent_caller_id_number\": \"+33189311209\"}, \"system_prompt\": null, \"initial_greeting\": null, \"wait_for_greeting\": false, \"pam_tier\": \"core\", \"interruption_threshold\": 100, \"ai_models\": {\"vad\": {\"provider\": \"silero\"}, \"stt\": {\"provider\": \"deepgram\", \"language\": \"en\", \"model\": \"nova-2\"}, \"tts\": {\"provider\": \"cartesia\", \"model\": \"sonic-2\", \"voice_id\": \"f9836c6e-a0bd-460e-9d3c-f7299fa60f94\"}, \"llm\": {\"provider\": \"openai\", \"model\": \"gpt-4o-mini\"}}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.267400+00:00"}
{"message": "dial_info parsed from metadata: {'firstName': 'Valued Customer', 'lastName': '', 'dial_info': {'agent_id': 11, 'call_direction': 'outbound', 'room_name': 'agent-call-309', 'supabase_call_id': 309, 'telnyx_call_control_id': None, 'default_pathway_id': 'd5fc510b-7635-4715-9066-e522daa2336d', 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'auth_token': None, 'phone_number': '+33661329235', 'sip_trunk_id': 'ST_6CYLZwTLMCe2', 'agent_caller_id_number': '+33189311209'}, 'system_prompt': None, 'initial_greeting': None, 'wait_for_greeting': False, 'pam_tier': 'core', 'interruption_threshold': 100, 'ai_models': {'vad': {'provider': 'silero'}, 'stt': {'provider': 'deepgram', 'language': 'en', 'model': 'nova-2'}, 'tts': {'provider': 'cartesia', 'model': 'sonic-2', 'voice_id': 'f9836c6e-a0bd-460e-9d3c-f7299fa60f94'}, 'llm': {'provider': 'openai', 'model': 'gpt-4o-mini'}}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.269407+00:00"}
{"message": "Using firstName from metadata or default: Valued Customer", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.269407+00:00"}
{"message": "OUTBOUND CALL: To +33661329235", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.269407+00:00"}
{"message": "Default pathway found for agent: d5fc510b-7635-4715-9066-e522daa2336d", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.271412+00:00"}
{"message": "Agent ID from metadata: 11", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.271412+00:00"}
{"message": "User ID from metadata: b55837c4-270f-4f1f-8023-7ab09ee5f44d", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.271412+00:00"}
{"message": "System prompt is null - using WorkflowAgent with pathway-specific prompts", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.273416+00:00"}
{"message": "PAM Tier: core, Wait for Greeting: False, Interruption Threshold: 100ms", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.273416+00:00"}
{"message": "DEBUG: Full dial_info structure: {'firstName': 'Valued Customer', 'lastName': '', 'dial_info': {'agent_id': 11, 'call_direction': 'outbound', 'room_name': 'agent-call-309', 'supabase_call_id': 309, 'telnyx_call_control_id': None, 'default_pathway_id': 'd5fc510b-7635-4715-9066-e522daa2336d', 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'auth_token': None, 'phone_number': '+33661329235', 'sip_trunk_id': 'ST_6CYLZwTLMCe2', 'agent_caller_id_number': '+33189311209'}, 'system_prompt': None, 'initial_greeting': None, 'wait_for_greeting': False, 'pam_tier': 'core', 'interruption_threshold': 100, 'ai_models': {'vad': {'provider': 'silero'}, 'stt': {'provider': 'deepgram', 'language': 'en', 'model': 'nova-2'}, 'tts': {'provider': 'cartesia', 'model': 'sonic-2', 'voice_id': 'f9836c6e-a0bd-460e-9d3c-f7299fa60f94'}, 'llm': {'provider': 'openai', 'model': 'gpt-4o-mini'}}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.273416+00:00"}
{"message": "DEBUG: dial_info.get('dial_info'): {'agent_id': 11, 'call_direction': 'outbound', 'room_name': 'agent-call-309', 'supabase_call_id': 309, 'telnyx_call_control_id': None, 'default_pathway_id': 'd5fc510b-7635-4715-9066-e522daa2336d', 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'auth_token': None, 'phone_number': '+33661329235', 'sip_trunk_id': 'ST_6CYLZwTLMCe2', 'agent_caller_id_number': '+33189311209'}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.273416+00:00"}
{"message": "DEBUG: Extracted agent_caller_id_number: +33189311209", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.273416+00:00"}
{"message": "Agent Caller ID (agent_caller_id_number) found in job metadata: +33189311209", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.273416+00:00"}
{"message": "Utilisation du SIP Trunk ID des métadonnées: ST_6CYLZwTLMCe2", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.276678+00:00"}
{"message": "Utilisation du prompt système formaté depuis les métadonnées.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.276678+00:00"}
{"message": "Final dial info for agent: {'firstName': 'Valued Customer', 'lastName': '', 'dial_info': {'agent_id': 11, 'call_direction': 'outbound', 'room_name': 'agent-call-309', 'supabase_call_id': 309, 'telnyx_call_control_id': None, 'default_pathway_id': 'd5fc510b-7635-4715-9066-e522daa2336d', 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'auth_token': None, 'phone_number': '+33661329235', 'sip_trunk_id': 'ST_6CYLZwTLMCe2', 'agent_caller_id_number': '+33189311209'}, 'system_prompt': None, 'initial_greeting': None, 'wait_for_greeting': False, 'pam_tier': 'core', 'interruption_threshold': 100, 'ai_models': {'vad': {'provider': 'silero'}, 'stt': {'provider': 'deepgram', 'language': 'en', 'model': 'nova-2'}, 'tts': {'provider': 'cartesia', 'model': 'sonic-2', 'voice_id': 'f9836c6e-a0bd-460e-9d3c-f7299fa60f94'}, 'llm': {'provider': 'openai', 'model': 'gpt-4o-mini'}}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.276678+00:00"}
{"message": "Agent will use name: Valued Customer", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.276678+00:00"}
{"message": "Dialing number: +33661329235", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.276678+00:00"}
{"message": "Configuration IA chargée depuis les métadonnées: {'vad': {'provider': 'silero'}, 'stt': {'provider': 'deepgram', 'language': 'en', 'model': 'nova-2'}, 'tts': {'provider': 'cartesia', 'model': 'sonic-2', 'voice_id': 'f9836c6e-a0bd-460e-9d3c-f7299fa60f94'}, 'llm': {'provider': 'openai', 'model': 'gpt-4o-mini'}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.276678+00:00"}
{"message": "Plugin VAD Silero chargé.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.736698+00:00"}
{"message": "Plugin STT Deepgram chargé (lang: en, model: nova-2).", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.736698+00:00"}
{"message": "Plugin TTS Cartesia chargé (model: sonic-2, voice: f9836c6e-a0bd-460e-9d3c-f7299fa60f94).", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:45.748470+00:00"}
{"message": "Plugin LLM OpenAI chargé (model: gpt-4o-mini).", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:47.049864+00:00"}
{"message": "Task exception was never retrieved\nfuture: <Task finished name='AgentTask_on_enter' coro=<BasePathwayAgent.on_enter() done, defined at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\pathway_global_context.py:452> exception=ValueError('VoiceAgent userdata is not set')>", "level": "ERROR", "name": "asyncio", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\pathway_global_context.py\", line 458, in on_enter\n    if self.session and hasattr(self.session, 'userdata'):\n                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\voice\\agent_session.py\", line 264, in userdata\n    raise ValueError(\"VoiceAgent userdata is not set\")\nValueError: VoiceAgent userdata is not set", "timestamp": "2025-07-23T19:22:47.148961+00:00"}
{"message": "Instantiating AgentSession with dynamically loaded plugins.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:47.172105+00:00"}
{"message": "AgentSession created successfully with dynamic plugins.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:47.172105+00:00"}
{"message": "OUTBOUND CALL: Attempting SIP dial to +33661329235 via trunk ST_6CYLZwTLMCe2 pour Supabase ID: 309", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:47.173116+00:00"}
{"message": "Préparation de l'en-tête SIP X-Client-State avec valeur (encodée): MzA5", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:47.173116+00:00"}
{"message": "Tentative de mise à jour des infos pour room agent-call-309 (Supabase ID: 309) avec payload: {'new_status': 'dialing', 'supabase_call_id': '309'} via backend: http://localhost:8000/calls/room/agent-call-309/status", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:47.173116+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.31 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.576392+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.31 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.576392+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.31 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.576392+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.31 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.577394+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.31 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.577394+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.31 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.577394+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.31 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.577394+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.31 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.577394+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.31 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.577394+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.31 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.578393+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.31 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.578393+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.31 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.578393+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.31 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.578393+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.31 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.578393+00:00"}
{"message": "Running <Task pending name='job_user_entrypoint' coro=<entrypoint() running at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\outbound_agent.py:1056> cb=[_JobProc._run_job_task.<locals>.<lambda>() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:274, _JobProc._run_job_task.<locals>.log_exception() at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\ipc\\job_proc_lazy_main.py:276]> took too long: 2.33 seconds", "level": "WARNING", "name": "livekit.agents", "timestamp": "2025-07-23T19:22:47.579393+00:00"}
{"message": "Infos mises à jour avec succès pour room agent-call-309 (Supabase ID: 309): {'message': 'Call status updated successfully', 'call': {'id': 309, 'created_at': '2025-07-23T19:22:40.377576+00:00', 'updated_at': '2025-07-23T19:22:47.915957+00:00', 'agent_id': 11, 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'to_phone_number': '+33661329235', 'status': 'dialing', 'initiated_at': None, 'answered_at': None, 'ended_at': None, 'call_duration': None, 'from_phone_number': None, 'ended_reason': None, 'livekit_room_name': None, 'livekit_participant_identity': None, 'provider': None, 'livekit_outbound_trunk_id': None, 'call_control_id': None, 'agent_name': None, 'telnyx_call_session_id': None, 'batch_campaign_id': None, 'batch_call_item_id': None, 'call_type': 'outbound', 'phone_number_e164': '+33661329235', 'contact_name': None, 'room_name': 'agent-call-309', 'pathway_execution_id': None, 'current_pathway_node_id': None, 'pathway_variables': None, 'call_direction': 'outbound', 'caller_number': None, 'agent_process_pid': 6108, 'error_message': None, 'duration_seconds': None}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:47.877444+00:00"}
{"message": "Appel à ctx.api.sip.create_sip_participant avec phoneNumber: +33661329235, trunk: ST_6CYLZwTLMCe2, from: +33189311209, metadata: {\"supabase_call_id\": \"309\"}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:47.878452+00:00"}
{"message": "SIP call created for +33661329235. Waiting for SIP participant to join room.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:48.569123+00:00"}
{"message": "SIP participant 'agent_sip_participant_+33661329235' (PA_bL6yHhBupGmK) connected to room agent-call-309.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:48.572128+00:00"}
{"message": "Tentative de mise à jour des infos pour room agent-call-309 (Supabase ID: 309) avec payload: {'new_status': 'connected', 'supabase_call_id': '309'} via backend: http://localhost:8000/calls/room/agent-call-309/status", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:48.572128+00:00"}
{"message": "Infos mises à jour avec succès pour room agent-call-309 (Supabase ID: 309): {'message': 'Call status updated successfully', 'call': {'id': 309, 'created_at': '2025-07-23T19:22:40.377576+00:00', 'updated_at': '2025-07-23T19:22:49.307869+00:00', 'agent_id': 11, 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'to_phone_number': '+33661329235', 'status': 'connected', 'initiated_at': None, 'answered_at': None, 'ended_at': None, 'call_duration': None, 'from_phone_number': None, 'ended_reason': None, 'livekit_room_name': None, 'livekit_participant_identity': None, 'provider': None, 'livekit_outbound_trunk_id': None, 'call_control_id': None, 'agent_name': None, 'telnyx_call_session_id': None, 'batch_campaign_id': None, 'batch_call_item_id': None, 'call_type': 'outbound', 'phone_number_e164': '+33661329235', 'contact_name': None, 'room_name': 'agent-call-309', 'pathway_execution_id': None, 'current_pathway_node_id': None, 'pathway_variables': None, 'call_direction': 'outbound', 'caller_number': None, 'agent_process_pid': 6108, 'error_message': None, 'duration_seconds': None}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:49.269639+00:00"}
{"message": "Call connected (OUTBOUND), participant joined. Starting agent session for supabase_call_id: 309", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:49.270637+00:00"}
{"message": "run_session_safely: AVANT appel à session.start() pour supabase_call_id: 309 (UTILISATION DE ConversationAgent - OUTBOUND CALL)", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:49.270637+00:00"}
{"message": "Auto-starting pathway execution: pathway_id=d5fc510b-7635-4715-9066-e522daa2336d, agent_id=11, call_id=309", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:49.284685+00:00"}
{"message": "Checking for default pathway for agent 11 and call 309", "level": "INFO", "name": "agent_pathway_integration", "timestamp": "2025-07-23T19:22:49.284685+00:00"}
{"message": "Created pathway execution record: b9faa6ad-5707-4d4c-817b-0238b6d4cfd4", "level": "INFO", "name": "agent_pathway_integration", "timestamp": "2025-07-23T19:22:49.439473+00:00"}
{"message": "Linked call 309 to pathway execution b9faa6ad-5707-4d4c-817b-0238b6d4cfd4", "level": "INFO", "name": "agent_pathway_integration", "timestamp": "2025-07-23T19:22:49.480042+00:00"}
{"message": "Pathway execution started successfully: b9faa6ad-5707-4d4c-817b-0238b6d4cfd4", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:49.486343+00:00"}
{"message": "run_session_safely: APRÈS appel à session.start() pour supabase_call_id: 309 (OUTBOUND CALL). La session devrait avoir démarré et exécuté la logique de l'agent.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:49.520251+00:00"}
{"message": "Agent session task finished normally for outbound call supabase_call_id: 309.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:49.520251+00:00"}
{"message": "Fin du job pour la room agent-call-309 (OUTBOUND call, Supabase ID: 309). Statut final de session: completed", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:49.521247+00:00"}
{"message": "TELNYX_API_KEY ou call_control_id manquant pour récupérer la durée réelle d'appel.", "level": "WARNING", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:49.521247+00:00"}
{"message": "Tentative de mise à jour des infos pour room agent-call-309 (Supabase ID: 309) avec payload: {'new_status': 'completed', 'supabase_call_id': '309', 'call_duration_seconds': 0} via backend: http://localhost:8000/calls/room/agent-call-309/status", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:49.521247+00:00"}
{"message": "Infos mises à jour avec succès pour room agent-call-309 (Supabase ID: 309): {'message': 'Call status updated successfully', 'call': {'id': 309, 'created_at': '2025-07-23T19:22:40.377576+00:00', 'updated_at': '2025-07-23T19:22:50.257634+00:00', 'agent_id': 11, 'user_id': 'b55837c4-270f-4f1f-8023-7ab09ee5f44d', 'to_phone_number': '+33661329235', 'status': 'completed', 'initiated_at': None, 'answered_at': None, 'ended_at': '2025-07-23T19:22:50.182899+00:00', 'call_duration': None, 'from_phone_number': None, 'ended_reason': None, 'livekit_room_name': None, 'livekit_participant_identity': None, 'provider': None, 'livekit_outbound_trunk_id': None, 'call_control_id': None, 'agent_name': None, 'telnyx_call_session_id': None, 'batch_campaign_id': None, 'batch_call_item_id': None, 'call_type': 'outbound', 'phone_number_e164': '+33661329235', 'contact_name': None, 'room_name': 'agent-call-309', 'pathway_execution_id': 'b9faa6ad-5707-4d4c-817b-0238b6d4cfd4', 'current_pathway_node_id': 'conversation-1752584446694', 'pathway_variables': None, 'call_direction': 'outbound', 'caller_number': None, 'agent_process_pid': 6108, 'error_message': None, 'duration_seconds': 0}}", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:50.218979+00:00"}
{"message": "Session task awaited and completed for supabase_call_id 309.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:50.220595+00:00"}
{"message": "Setting up to wait for participant 'agent_sip_participant_+33661329235' to disconnect as a final check...", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:50.221611+00:00"}
{"message": "Now waiting for participant 'agent_sip_participant_+33661329235' to disconnect (final check)...", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:50.221611+00:00"}
{"message": "Timeout waiting for participant 'agent_sip_participant_+33661329235' to disconnect (final check). Session likely already handled by agent logic or session_task.", "level": "WARNING", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:55.228183+00:00"}
{"message": "Entrypoint for supabase_call_id 309 completed.", "level": "INFO", "name": "outbound-caller", "timestamp": "2025-07-23T19:22:55.229308+00:00"}
{"message": "closing agent session due to participant disconnect (disable via `RoomInputOptions.close_on_disconnect=False`)", "level": "INFO", "name": "livekit.agents", "participant": "agent_sip_participant_+33661329235", "reason": "CLIENT_INITIATED", "timestamp": "2025-07-23T19:22:55.514037+00:00"}
{"message": "Task exception was never retrieved\nfuture: <Task finished name='AgentTask_on_exit' coro=<BasePathwayAgent.on_exit() done, defined at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\pathway_global_context.py:472> exception=ValueError('VoiceAgent userdata is not set')>", "level": "ERROR", "name": "asyncio", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\pathway_global_context.py\", line 477, in on_exit\n    if self.session and hasattr(self.session, 'userdata'):\n                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\voice\\agent_session.py\", line 264, in userdata\n    raise ValueError(\"VoiceAgent userdata is not set\")\nValueError: VoiceAgent userdata is not set", "timestamp": "2025-07-23T19:22:55.520038+00:00"}
{"message": "draining worker", "level": "INFO", "name": "livekit.agents", "id": "AW_HVeLtvWWAw9s", "timeout": 1800, "timestamp": "2025-07-23T19:23:03.294518+00:00"}
{"message": "shutting down worker", "level": "INFO", "name": "livekit.agents", "id": "AW_HVeLtvWWAw9s", "timestamp": "2025-07-23T19:23:03.296203+00:00"}
{"message": "Task exception was never retrieved\nfuture: <Task finished name='AgentTask_on_enter' coro=<BasePathwayAgent.on_enter() done, defined at C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\pathway_global_context.py:452> exception=ValueError('VoiceAgent userdata is not set')>", "level": "ERROR", "name": "asyncio", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\pathway_global_context.py\", line 458, in on_enter\n    if self.session and hasattr(self.session, 'userdata'):\n                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\y.djemai\\pam-testdrive\\MARK_I\\backend_python\\agents\\venv\\Lib\\site-packages\\livekit\\agents\\voice\\agent_session.py\", line 264, in userdata\n    raise ValueError(\"VoiceAgent userdata is not set\")\nValueError: VoiceAgent userdata is not set", "timestamp": "2025-07-23T19:23:03.450881+00:00"}
