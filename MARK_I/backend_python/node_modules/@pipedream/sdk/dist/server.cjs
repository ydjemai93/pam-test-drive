"use strict";var C=Object.defineProperty,he=Object.defineProperties,le=Object.getOwnPropertyDescriptor,pe=Object.getOwnPropertyDescriptors,fe=Object.getOwnPropertyNames,E=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var j=(r,e,t)=>e in r?C(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,f=(r,e)=>{for(var t in e||(e={}))H.call(e,t)&&j(r,t,e[t]);if(E)for(var t of E(e))F.call(e,t)&&j(r,t,e[t]);return r},m=(r,e)=>he(r,pe(e));var L=(r,e)=>{var t={};for(var n in r)H.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&E)for(var n of E(r))e.indexOf(n)<0&&F.call(r,n)&&(t[n]=r[n]);return t};var me=(r,e)=>{for(var t in e)C(r,t,{get:e[t],enumerable:!0})},ge=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of fe(e))!H.call(r,s)&&s!==t&&C(r,s,{get:()=>e[s],enumerable:!(n=le(e,s))||n.enumerable});return r};var ye=r=>ge(C({},"__esModule",{value:!0}),r);var p=(r,e,t)=>j(r,typeof e!="symbol"?e+"":e,t);var gt={};me(gt,{AppAuthType:()=>ue,BackendClient:()=>I,BaseClient:()=>k,DEBUG:()=>R,HTTPAuthType:()=>de,createBackendClient:()=>mt});module.exports=ye(gt);var N,O,te;(typeof navigator=="undefined"||!((te=(O=navigator.userAgent)==null?void 0:O.startsWith)!=null&&te.call(O,"Mozilla/5.0 ")))&&(N="oauth4webapi/v3.1.4");function z(r,e){if(r==null)return!1;try{return r instanceof e||Object.getPrototypeOf(r)[Symbol.toStringTag]===e.prototype[Symbol.toStringTag]}catch(t){return!1}}var w="ERR_INVALID_ARG_VALUE",b="ERR_INVALID_ARG_TYPE";function l(r,e,t){let n=new TypeError(r,{cause:t});return Object.assign(n,{code:e}),n}var we=Symbol(),_e=Symbol(),be=Symbol(),Re=Symbol(),Tt=Symbol(),Te=Symbol(),xt=Symbol(),xe=new TextEncoder,Pe=new TextDecoder;function X(r){return typeof r=="string"?xe.encode(r):Pe.decode(r)}var Y=32768;function ke(r){r instanceof ArrayBuffer&&(r=new Uint8Array(r));let e=[];for(let t=0;t<r.byteLength;t+=Y)e.push(String.fromCharCode.apply(null,r.subarray(t,t+Y)));return btoa(e.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Ae(r){try{let e=atob(r.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}catch(e){throw l("The input to be decoded is not correctly encoded.",w,e)}}function Q(r){return typeof r=="string"?Ae(r):ke(r)}var x=class extends Error{constructor(t,n){var s;super(t,n);p(this,"code");this.name=this.constructor.name,this.code=rt,(s=Error.captureStackTrace)==null||s.call(Error,this,this.constructor)}},J=class extends Error{constructor(t,n){var s;super(t,n);p(this,"code");this.name=this.constructor.name,n!=null&&n.code&&(this.code=n==null?void 0:n.code),(s=Error.captureStackTrace)==null||s.call(Error,this,this.constructor)}};function u(r,e,t){return new J(r,{code:e,cause:t})}function v(r){return!(r===null||typeof r!="object"||Array.isArray(r))}function Se(r){z(r,Headers)&&(r=Object.fromEntries(r.entries()));let e=new Headers(r);if(N&&!e.has("user-agent")&&e.set("user-agent",N),e.has("authorization"))throw l('"options.headers" must not include the "authorization" header name',w);if(e.has("dpop"))throw l('"options.headers" must not include the "dpop" header name',w);return e}function Ee(r){if(typeof r=="function"&&(r=r()),!(r instanceof AbortSignal))throw l('"options.signal" must return or be an instance of AbortSignal',b);return r}function W(r,e,t,n,s){try{if(typeof r!="number"||!Number.isFinite(r))throw l(`${t} must be a number`,b,s);if(r>0)return;throw l(e&&r!==0?`${t} must be a non-negative number`:`${t} must be a positive number`,w,s)}catch(a){throw n?u(a.message,n,s):a}}function _(r,e,t,n){try{if(typeof r!="string")throw l(`${e} must be a string`,b,n);if(r.length===0)throw l(`${e} must not be empty`,w,n)}catch(s){throw t?u(s.message,t,n):s}}function re(r){Oe(r,"application/json")}function Ce(r,...e){let t='"response" content-type must be ';if(e.length>2){let n=e.pop();t+=`${e.join(", ")}, or ${n}`}else e.length===2?t+=`${e[0]} or ${e[1]}`:t+=e[0];return u(t,nt,r)}function Oe(r,e){if($e(r)!==e)throw Ce(r,e)}function ve(r){let e=r==null?void 0:r[_e];return typeof e=="number"&&Number.isFinite(e)?e:0}function Ie(r){let e=r==null?void 0:r[be];return typeof e=="number"&&Number.isFinite(e)&&Math.sign(e)!==-1?e:30}function Ue(){return Math.floor(Date.now()/1e3)}function ne(r){if(typeof r!="object"||r===null)throw l('"as" must be an object',b);_(r.issuer,'"as.issuer"')}function se(r){if(typeof r!="object"||r===null)throw l('"client" must be an object',b);_(r.client_id,'"client.client_id"')}function ae(r){return _(r,'"clientSecret"'),(e,t,n,s)=>{n.set("client_id",t.client_id),n.set("client_secret",r)}}var De=URL.parse?(r,e)=>URL.parse(r,e):(r,e)=>{try{return new URL(r,e)}catch(t){return null}};function je(r,e){if(e&&r.protocol!=="https:")throw u("only requests to HTTPS are allowed",at,r);if(r.protocol!=="https:"&&r.protocol!=="http:")throw u("only HTTP and HTTPS requests are allowed",ot,r)}function Z(r,e,t,n){let s;if(typeof r!="string"||!(s=De(r)))throw u(`authorization server metadata does not contain a valid ${t?`"as.mtls_endpoint_aliases.${e}"`:`"as.${e}"`}`,r===void 0?it:ct,{attribute:t?`mtls_endpoint_aliases.${e}`:e});return je(s,n),s}function He(r,e,t,n){return t&&r.mtls_endpoint_aliases&&e in r.mtls_endpoint_aliases?Z(r.mtls_endpoint_aliases[e],e,t,n):Z(r[e],e,t,n)}var q=class extends Error{constructor(t,n){var s;super(t,n);p(this,"cause");p(this,"code");p(this,"error");p(this,"status");p(this,"error_description");p(this,"response");this.name=this.constructor.name,this.code=tt,this.cause=n.cause,this.error=n.cause.error,this.status=n.response.status,this.error_description=n.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:n.response}),(s=Error.captureStackTrace)==null||s.call(Error,this,this.constructor)}};var G=class extends Error{constructor(t,n){var s;super(t,n);p(this,"cause");p(this,"code");p(this,"response");p(this,"status");this.name=this.constructor.name,this.code=et,this.cause=n.cause,this.status=n.response.status,this.response=n.response,Object.defineProperty(this,"response",{enumerable:!1}),(s=Error.captureStackTrace)==null||s.call(Error,this,this.constructor)}};function Le(r){return r.length>=2&&r[0]==='"'&&r[r.length-1]==='"'?r.slice(1,-1):r}var We=/((?:,|, )?[0-9a-zA-Z!#$%&'*+-.^_`|~]+=)/,Ne=/(?:^|, ?)([0-9a-zA-Z!#$%&'*+\-.^_`|~]+)(?=$|[ ,])/g;function Je(r,e){let t=e.split(We).slice(1);if(!t.length)return{scheme:r.toLowerCase(),parameters:{}};t[t.length-1]=t[t.length-1].replace(/,$/,"");let n={};for(let s=1;s<t.length;s+=2){let a=s;if(t[a][0]==='"')for(;t[a].slice(-1)!=='"'&&++s<t.length;)t[a]+=t[s];let o=t[a-1].replace(/^(?:, ?)|=$/g,"").toLowerCase();n[o]=Le(t[a])}return{scheme:r.toLowerCase(),parameters:n}}function qe(r){if(!z(r,Response))throw l('"response" must be an instance of Response',b);let e=r.headers.get("www-authenticate");if(e===null)return;let t=[];for(let{1:s,index:a}of e.matchAll(Ne))t.push([s,a]);return t.length?t.map(([s,a],o,d)=>{let c=d[o+1],i;return c?i=e.slice(a,c[1]):i=e.slice(a),Je(s,i)}):void 0}function Ge(r){if(!Ye.has(r))throw l('"options.DPoP" is not a valid DPoPHandle',w)}var Pt=Symbol();function $e(r){var e;return(e=r.headers.get("content-type"))==null?void 0:e.split(";")[0]}async function ze(r,e,t,n,s,a,o){return await t(r,e,s,a),a.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),((o==null?void 0:o[Re])||fetch)(n.href,{body:s,headers:Object.fromEntries(a.entries()),method:"POST",redirect:"manual",signal:o!=null&&o.signal?Ee(o.signal):void 0})}async function Ke(r,e,t,n,s,a){var i;let o=He(r,"token_endpoint",e.use_mtls_endpoint_aliases,(a==null?void 0:a[we])!==!0);s.set("grant_type",n);let d=Se(a==null?void 0:a.headers);d.set("accept","application/json"),(a==null?void 0:a.DPoP)!==void 0&&(Ge(a.DPoP),await a.DPoP.addProof(o,d,"POST"));let c=await ze(r,e,t,o,s,d,a);return(i=a==null?void 0:a.DPoP)==null||i.cacheNonce(c),c}var Ve=new WeakMap,Be=new WeakMap;async function Me(r,e,t,n,s){var d;if(ne(r),se(e),!z(t,Response))throw l('"response" must be an instance of Response',b);let a;if(a=qe(t))throw new G("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:a,response:t});if(t.status!==200){let c;throw(c=await ut(t))?(await((d=t.body)==null?void 0:d.cancel()),new q("server responded with an error in the response body",{cause:c,response:t})):u('"response" is not a conform Token Endpoint response (unexpected HTTP status code)',st,t)}ce(t),re(t);let o;try{o=await t.json()}catch(c){throw u('failed to parse "response" body as JSON',$,c)}if(!v(o))throw u('"response" body must be a top level object',h,{body:o});if(_(o.access_token,'"response" body "access_token" property',h,{body:o}),_(o.token_type,'"response" body "token_type" property',h,{body:o}),o.token_type=o.token_type.toLowerCase(),o.token_type!=="dpop"&&o.token_type!=="bearer")throw new x("unsupported `token_type` value",{cause:{body:o}});if(o.expires_in!==void 0){let c=typeof o.expires_in!="number"?parseFloat(o.expires_in):o.expires_in;W(c,!1,'"response" body "expires_in" property',h,{body:o}),o.expires_in=c}if(o.refresh_token!==void 0&&_(o.refresh_token,'"response" body "refresh_token" property',h,{body:o}),o.scope!==void 0&&typeof o.scope!="string")throw u('"response" body "scope" property must be a string',h,{body:o});if(o.id_token!==void 0){_(o.id_token,'"response" body "id_token" property',h,{body:o});let c=["aud","exp","iat","iss","sub"];e.require_auth_time===!0&&c.push("auth_time"),e.default_max_age!==void 0&&(W(e.default_max_age,!1,'"client.default_max_age"'),c.push("auth_time")),n!=null&&n.length&&c.push(...n);let{claims:i,jwt:g}=await dt(o.id_token,ht.bind(void 0,e.id_token_signed_response_alg,r.id_token_signing_alg_values_supported,"RS256"),ve(e),Ie(e),s==null?void 0:s[Te]).then(Ze.bind(void 0,c)).then(Xe.bind(void 0,r)).then(Fe.bind(void 0,e.client_id));if(Array.isArray(i.aud)&&i.aud.length!==1){if(i.azp===void 0)throw u('ID Token "aud" (audience) claim includes additional untrusted audiences',P,{claims:i,claim:"aud"});if(i.azp!==e.client_id)throw u('unexpected ID Token "azp" (authorized party) claim value',P,{expected:e.client_id,claims:i,claim:"azp"})}i.auth_time!==void 0&&W(i.auth_time,!1,'ID Token "auth_time" (authentication time)',h,{claims:i}),Be.set(t,g),Ve.set(o,i)}return o}function Fe(r,e){if(Array.isArray(e.claims.aud)){if(!e.claims.aud.includes(r))throw u('unexpected JWT "aud" (audience) claim value',P,{expected:r,claims:e.claims,claim:"aud"})}else if(e.claims.aud!==r)throw u('unexpected JWT "aud" (audience) claim value',P,{expected:r,claims:e.claims,claim:"aud"});return e}function Xe(r,e){var n,s;let t=(s=(n=r[lt])==null?void 0:n.call(r,e))!=null?s:r.issuer;if(e.claims.iss!==t)throw u('unexpected JWT "iss" (issuer) claim value',P,{expected:t,claims:e.claims,claim:"iss"});return e}var Ye=new WeakSet;var Qe={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function Ze(r,e){for(let t of r)if(e.claims[t]===void 0)throw u(`JWT "${t}" (${Qe[t]}) claim missing`,h,{claims:e.claims});return e}var kt=Symbol(),At=Symbol();var et="OAUTH_WWW_AUTHENTICATE_CHALLENGE",tt="OAUTH_RESPONSE_BODY_ERROR",rt="OAUTH_UNSUPPORTED_OPERATION";var $="OAUTH_PARSE_ERROR",h="OAUTH_INVALID_RESPONSE";var nt="OAUTH_RESPONSE_IS_NOT_JSON",st="OAUTH_RESPONSE_IS_NOT_CONFORM",at="OAUTH_HTTP_REQUEST_FORBIDDEN",ot="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",ee="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",P="OAUTH_JWT_CLAIM_COMPARISON_FAILED";var it="OAUTH_MISSING_SERVER_METADATA",ct="OAUTH_INVALID_SERVER_METADATA";async function oe(r,e,t,n,s){return ne(r),se(e),Ke(r,e,t,"client_credentials",new URLSearchParams(n),s)}async function ie(r,e,t,n){return Me(r,e,t,void 0,n)}function ce(r){if(r.bodyUsed)throw l('"response" body has been used already',w)}async function ut(r){if(r.status>399&&r.status<500){ce(r),re(r);try{let e=await r.clone().json();if(v(e)&&typeof e.error=="string"&&e.error.length)return e}catch(e){}}}async function dt(r,e,t,n,s){let{0:a,1:o,length:d}=r.split(".");if(d===5)if(s!==void 0)r=await s(r),{0:a,1:o,length:d}=r.split(".");else throw new x("JWE decryption is not configured",{cause:r});if(d!==3)throw u("Invalid JWT",h,r);let c;try{c=JSON.parse(X(Q(a)))}catch(y){throw u("failed to parse JWT Header body as base64url encoded JSON",$,y)}if(!v(c))throw u("JWT Header must be a top level object",h,r);if(e(c),c.crit!==void 0)throw new x('no JWT "crit" header parameter extensions are supported',{cause:{header:c}});let i;try{i=JSON.parse(X(Q(o)))}catch(y){throw u("failed to parse JWT Payload body as base64url encoded JSON",$,y)}if(!v(i))throw u("JWT Payload must be a top level object",h,r);let g=Ue()+t;if(i.exp!==void 0){if(typeof i.exp!="number")throw u('unexpected JWT "exp" (expiration time) claim type',h,{claims:i});if(i.exp<=g-n)throw u('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',ee,{claims:i,now:g,tolerance:n,claim:"exp"})}if(i.iat!==void 0&&typeof i.iat!="number")throw u('unexpected JWT "iat" (issued at) claim type',h,{claims:i});if(i.iss!==void 0&&typeof i.iss!="string")throw u('unexpected JWT "iss" (issuer) claim type',h,{claims:i});if(i.nbf!==void 0){if(typeof i.nbf!="number")throw u('unexpected JWT "nbf" (not before) claim type',h,{claims:i});if(i.nbf>g+n)throw u('unexpected JWT "nbf" (not before) claim value',ee,{claims:i,now:g,tolerance:n,claim:"nbf"})}if(i.aud!==void 0&&typeof i.aud!="string"&&!Array.isArray(i.aud))throw u('unexpected JWT "aud" (audience) claim type',h,{claims:i});return{header:c,claims:i,jwt:r}}function ht(r,e,t,n){if(r!==void 0){if(typeof r=="string"?n.alg!==r:!r.includes(n.alg))throw u('unexpected JWT "alg" header parameter',h,{header:n,expected:r,reason:"client configuration"});return}if(Array.isArray(e)){if(!e.includes(n.alg))throw u('unexpected JWT "alg" header parameter',h,{header:n,expected:e,reason:"authorization server metadata"});return}if(t!==void 0){if(typeof t=="string"?n.alg!==t:typeof t=="function"?!t(n.alg):!t.includes(n.alg))throw u('unexpected JWT "alg" header parameter',h,{header:n,expected:t,reason:"default value"});return}throw u('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:r,issuer:e,fallback:t})}var St=Symbol(),Et=Symbol();var Ct=Symbol(),Ot=Symbol(),lt=Symbol();var K="1.6.9";var ue=(n=>(n.OAuth="oauth",n.Keys="keys",n.None="none",n))(ue||{}),de=(n=>(n.None="none",n.StaticBearer="static_bearer_token",n.OAuth="oauth",n))(de||{}),ft=["token","password","secret","apiKey","authorization","auth","key","access_token"];function V(r,e=new WeakSet){if(r==null)return r;if(typeof r=="object"){if(e.has(r))return"[CIRCULAR]";if(e.add(r),Array.isArray(r))return r.map(n=>V(n,e));let t={};for(let[n,s]of Object.entries(r)){let a=ft.some(o=>n.toLowerCase().includes(o.toLowerCase()));t[n]=a?"[REDACTED]":V(s,e)}return t}return r}function R(...r){if(typeof process!="undefined"&&typeof process.env!="undefined"&&process.env.PD_SDK_DEBUG==="true"){let e=r.map(t=>V(t));console.log("[PD_SDK_DEBUG]",...e)}}var k=class{constructor(e){this.version=K;var s;this.environment=(s=e.environment)!=null?s:"production";let{apiHost:t="api.pipedream.com",workflowDomain:n="m.pipedream.net"}=e;this.apiHost=t,this.baseApiUrl=`https://${t}/v1`,this.workflowDomain=n}getEnvironment(){return this.environment}async makeRequest(e,t={}){let M=t,{params:n,headers:s,body:a,method:o="GET",baseURL:d=this.baseApiUrl}=M,c=L(M,["params","headers","body","method","baseURL"]),i=new URL(`${d}${e}`);if(n)for(let[S,D]of Object.entries(n))D!=null&&i.searchParams.append(S,String(D));let g=m(f({},s),{"X-PD-SDK-Version":K,"X-PD-Environment":this.environment}),y=null;a&&(a instanceof FormData||a instanceof URLSearchParams||typeof a=="string"?y=a:(y=JSON.stringify(a),g["Content-Type"]=g["Content-Type"]||"application/json"));let U=f({method:o,headers:g},c);["POST","PUT","PATCH"].includes(o.toUpperCase())&&y&&(U.body=y);let T=await fetch(i.toString(),U),A=await T.text();if(R("status: ",T.status),R("url: ",i.toString()),R("requestOptions: ",U),R("rawBody: ",A),!T.ok)throw new Error(`HTTP error! status: ${T.status}, body: ${A}`);let B=T.headers.get("Content-Type");if(B&&B.includes("application/json"))try{return JSON.parse(A)}catch(S){R("Couldn't parse json, falling back to raw",S)}return A}async makeAuthorizedRequest(e,t={}){let n=m(f({"Content-Type":"application/json"},t.headers),{Authorization:await this.authHeaders()});return this.makeRequest(e,m(f({},t),{headers:n}))}makeConnectRequest(e,t={}){let n="/connect";return this.projectId&&(n+=`/${this.projectId}`),n+=e,this.makeAuthorizedRequest(n,t)}getAccounts(e={}){return this.makeConnectRequest("/accounts",{method:"GET",params:e})}getApps(e){let t={};return e!=null&&e.q&&(t.q=e.q),(e==null?void 0:e.hasActions)!=null&&(t.has_actions=e.hasActions?"1":"0"),(e==null?void 0:e.hasComponents)!=null&&(t.has_components=e.hasComponents?"1":"0"),(e==null?void 0:e.hasTriggers)!=null&&(t.has_triggers=e.hasTriggers?"1":"0"),this.addRelationOpts(t,e),this.makeAuthorizedRequest("/apps",{method:"GET",params:t})}apps(e){return this.getApps(e)}getApp(e){let t=`/apps/${e}`;return this.makeAuthorizedRequest(t,{method:"GET"})}app(e){return this.getApp(e)}getComponents(e){let t={};e!=null&&e.app&&(t.app=e.app),e!=null&&e.q&&(t.q=e.q),this.addRelationOpts(t,e,20);let n="/components";return(e==null?void 0:e.componentType)==="trigger"?n="/triggers":(e==null?void 0:e.componentType)==="action"&&(n="/actions"),this.makeConnectRequest(n,{method:"GET",params:t})}components(e){return this.getComponents(e)}getComponent(e){let{key:t}=e,n=`/components/${t}`;return this.makeConnectRequest(n,{method:"GET"})}component({key:e}){return this.getComponent({key:e})}configureComponent(e){let{userId:t,externalUserId:n=t,componentId:s}=e,a=typeof s=="object"?s.key:s,o={external_user_id:n,id:a,prop_name:e.propName,configured_props:e.configuredProps,dynamic_props_id:e.dynamicPropsId,page:e.page,prev_context:e.prevContext,query:e.query};return this.makeConnectRequest("/components/configure",{method:"POST",body:o})}componentConfigure(e){return this.configureComponent(e)}reloadComponentProps(e){let{userId:t,externalUserId:n=t,componentId:s}=e,a=typeof s=="object"?s.key:s,o={external_user_id:n,id:a,configured_props:e.configuredProps,dynamic_props_id:e.dynamicPropsId};return this.makeConnectRequest("/components/props",{method:"POST",body:o})}componentReloadProps(e){return this.reloadComponentProps(e)}runAction(e){let{userId:t,externalUserId:n=t,actionId:s}=e,a=typeof s=="object"?s.key:s,o={external_user_id:n,id:a,configured_props:e.configuredProps,dynamic_props_id:e.dynamicPropsId,stash_id:e.stashId};return this.makeConnectRequest("/actions/run",{method:"POST",body:o})}actionRun(e){return this.runAction(e)}deployTrigger(e){let{userId:t,externalUserId:n=t,triggerId:s}=e,a=typeof s=="object"?s.key:s,o={external_user_id:n,id:a,configured_props:e.configuredProps,dynamic_props_id:e.dynamicPropsId,workflow_id:e.workflowId,webhook_url:e.webhookUrl};return this.makeConnectRequest("/triggers/deploy",{method:"POST",body:o})}triggerDeploy(e){return this.deployTrigger(e)}deleteTrigger(e){let{id:t,externalUserId:n,ignoreHookErrors:s=null}=e;return this.makeConnectRequest(`/deployed-triggers/${t}`,{method:"DELETE",params:{external_user_id:n,ignore_hook_errors:s}})}getTrigger(e){let{id:t,externalUserId:n}=e;return this.makeConnectRequest(`/deployed-triggers/${t}`,{method:"GET",params:{external_user_id:n}})}getTriggers(e){let{externalUserId:t}=e;return this.makeConnectRequest("/deployed-triggers",{method:"GET",params:{external_user_id:t}})}updateTrigger(e){let{id:t,externalUserId:n,active:s=null,configuredProps:a=null,name:o=null}=e;return this.makeConnectRequest(`/deployed-triggers/${t}`,{method:"PUT",params:{external_user_id:n},body:{active:s,configured_props:a,name:o}})}getTriggerEvents(e){let{id:t,externalUserId:n,limit:s=null}=e;return this.makeConnectRequest(`/deployed-triggers/${t}/events`,{method:"GET",params:{external_user_id:n,n:s}})}getTriggerWorkflows(e){let{id:t,externalUserId:n}=e;return this.makeConnectRequest(`/deployed-triggers/${t}/pipelines`,{method:"GET",params:{external_user_id:n}})}updateTriggerWorkflows(e){let{id:t,externalUserId:n,workflowIds:s}=e;if(!Array.isArray(s))throw new Error("workflowIds must be an array");return this.makeConnectRequest(`/deployed-triggers/${t}/pipelines`,{method:"PUT",params:{external_user_id:n},body:{workflow_ids:s}})}getTriggerWebhooks(e){let{id:t,externalUserId:n}=e;return this.makeConnectRequest(`/deployed-triggers/${t}/webhooks`,{method:"GET",params:{external_user_id:n}})}updateTriggerWebhooks(e){let{id:t,externalUserId:n,webhookUrls:s}=e;if(!Array.isArray(s))throw new Error("webhookUrls must be an array");return this.makeConnectRequest(`/deployed-triggers/${t}/webhooks`,{method:"PUT",params:{external_user_id:n},body:{webhook_urls:s}})}buildWorkflowUrl(e){let t=e.trim().replace(/[^\w-./:]/g,"").toLowerCase();if(!t)throw new Error("URL or endpoint ID is required");let n;if(t.includes(".")||t.startsWith("http")){let a;try{let o=t.startsWith("http")?t:`https://${t}`;a=new URL(o)}catch(o){throw new Error(`
          The provided URL is malformed: "${t}".
          Please provide a valid URL.
        `)}if(!a.hostname.endsWith(this.workflowDomain))throw new Error(`Invalid workflow domain. URL must end with ${this.workflowDomain}`);n=a.href}else{if(!/^e(n|o)[a-z0-9-]+$/i.test(t))throw new Error(`
          Invalid endpoint ID format.
          Must contain only letters, numbers, and hyphens, and start with either "en" or "eo".
        `);n=`https://${t}.${this.workflowDomain}`}return n}async invokeWorkflow(e,t={},n="none"){let{body:s,headers:a={}}=t,o=this.buildWorkflowUrl(e),d;switch(n){case"static_bearer_token":d=a.Authorization;break;case"oauth":d=await this.authHeaders();break;default:break}return this.makeRequest("",m(f({},t),{baseURL:o,method:t.method||"POST",headers:d?m(f({},a),{Authorization:d}):a,body:s}))}async invokeWorkflowForExternalUser(e,t,n={}){if(!(t!=null&&t.trim()))throw new Error("External user ID is required");if(!e.trim())throw new Error("Workflow URL is required");if(!await this.authHeaders())throw new Error("OAuth or token is required for invoking workflows for external users. Please pass credentials for a valid OAuth client");let{headers:s={}}=n;return this.invokeWorkflow(e,m(f({},n),{headers:m(f({},s),{"X-PD-External-User-ID":t})}),"oauth")}addRelationOpts(e,t,n){(t==null?void 0:t.limit)!=null&&(e.limit=""+t.limit),n!=null&&!e.limit&&(e.limit=""+n),t!=null&&t.after&&(e.after=t.after),t!=null&&t.before&&(e.before=t.before)}};function mt(r){return new I(r)}var I=class extends k{constructor(t){super(t);this.projectId="";this.ensureValidEnvironment(t.environment),this.projectId=t.projectId,"accessToken"in t.credentials?this.staticAccessToken=t.credentials.accessToken:this.oauthClient=this.newOauthClient(t.credentials,this.apiHost)}ensureValidEnvironment(t){if(!t||!["development","production"].includes(t))throw new Error("Project environment is required. Supported environments are development and production.")}newOauthClient({clientId:t,clientSecret:n},s){if(!t||!n)throw new Error("OAuth client ID and secret are required");let a={client_id:t},o=ae(n),d={issuer:s,token_endpoint:`https://${s}/v1/oauth/token`};return{client:a,clientAuth:o,as:d}}rawAccessToken(){return this.staticAccessToken?this.staticAccessToken:this.ensureValidOauthAccessToken()}authHeaders(){return this.staticAccessToken?`Bearer ${this.staticAccessToken}`:this.oauthAuthorizationHeader()}async ensureValidOauthAccessToken(){if(!this.oauthClient)throw new Error("OAuth client not configured");let{client:t,clientAuth:n,as:s}=this.oauthClient,a=0,o=2;for(;!this.oauthAccessToken||this.oauthAccessToken.expiresAt-Date.now()<1e3;){if(a>o)throw new Error("ran out of attempts trying to retrieve oauth access token");a>0&&await new Promise(c=>setTimeout(c,100));let d=new URLSearchParams;try{let c=await oe(s,t,n,d),i=await ie(s,t,c);this.oauthAccessToken={token:i.access_token,expiresAt:Date.now()+(i.expires_in||0)*1e3}}catch(c){}a++}return this.oauthAccessToken.token}async oauthAuthorizationHeader(){return`Bearer ${await this.ensureValidOauthAccessToken()}`}createConnectToken(t){let n=m(f({},t),{external_id:t.external_user_id});return this.makeConnectRequest("/tokens",{method:"POST",body:n})}getAccountById(t,n={}){return this.makeConnectRequest(`/accounts/${t}`,{method:"GET",params:n})}deleteAccount(t){return this.makeConnectRequest(`/accounts/${t}`,{method:"DELETE"})}deleteAccountsByApp(t){return this.makeConnectRequest(`/accounts/app/${t}`,{method:"DELETE"})}deleteExternalUser(t){return this.makeConnectRequest(`/users/${t}`,{method:"DELETE"})}getProjectInfo(){return this.makeConnectRequest("/projects/info",{method:"GET"})}makeProxyRequest(t,n){let s=btoa(n.url).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),a=n.options.headers||{},o=Object.keys(a).reduce((c,i)=>(c[`x-pd-proxy-${i}`]=a[i],c),{}),d={method:n.options.method,headers:o,params:t.searchParams};return n.options.body&&(d.body=n.options.body),this.makeConnectRequest(`/proxy/${s}`,d)}};0&&(module.exports={AppAuthType,BackendClient,BaseClient,DEBUG,HTTPAuthType,createBackendClient});
//# sourceMappingURL=server.cjs.map