var G=Object.defineProperty,U=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var _=(s,e,t)=>e in s?G(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,a=(s,e)=>{for(var t in e||(e={}))I.call(e,t)&&_(s,t,e[t]);if(R)for(var t of R(e))E.call(e,t)&&_(s,t,e[t]);return s},c=(s,e)=>U(s,v(e));var q=(s,e)=>{var t={};for(var r in s)I.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&R)for(var r of R(s))e.indexOf(r)<0&&E.call(s,r)&&(t[r]=s[r]);return t};import*as g from"oauth4webapi";var b="1.6.9";var D=(r=>(r.OAuth="oauth",r.Keys="keys",r.None="none",r))(D||{}),S=(r=>(r.None="none",r.StaticBearer="static_bearer_token",r.OAuth="oauth",r))(S||{}),$=["token","password","secret","apiKey","authorization","auth","key","access_token"];function w(s,e=new WeakSet){if(s==null)return s;if(typeof s=="object"){if(e.has(s))return"[CIRCULAR]";if(e.add(s),Array.isArray(s))return s.map(r=>w(r,e));let t={};for(let[r,n]of Object.entries(s)){let o=$.some(i=>r.toLowerCase().includes(i.toLowerCase()));t[r]=o?"[REDACTED]":w(n,e)}return t}return s}function m(...s){if(typeof process!="undefined"&&typeof process.env!="undefined"&&process.env.PD_SDK_DEBUG==="true"){let e=s.map(t=>w(t));console.log("[PD_SDK_DEBUG]",...e)}}var k=class{constructor(e){this.version=b;var n;this.environment=(n=e.environment)!=null?n:"production";let{apiHost:t="api.pipedream.com",workflowDomain:r="m.pipedream.net"}=e;this.apiHost=t,this.baseApiUrl=`https://${t}/v1`,this.workflowDomain=r}getEnvironment(){return this.environment}async makeRequest(e,t={}){let A=t,{params:r,headers:n,body:o,method:i="GET",baseURL:p=this.baseApiUrl}=A,u=q(A,["params","headers","body","method","baseURL"]),d=new URL(`${p}${e}`);if(r)for(let[f,x]of Object.entries(r))x!=null&&d.searchParams.append(f,String(x));let T=c(a({},n),{"X-PD-SDK-Version":b,"X-PD-Environment":this.environment}),h=null;o&&(o instanceof FormData||o instanceof URLSearchParams||typeof o=="string"?h=o:(h=JSON.stringify(o),T["Content-Type"]=T["Content-Type"]||"application/json"));let C=a({method:i,headers:T},u);["POST","PUT","PATCH"].includes(i.toUpperCase())&&h&&(C.body=h);let l=await fetch(d.toString(),C),y=await l.text();if(m("status: ",l.status),m("url: ",d.toString()),m("requestOptions: ",C),m("rawBody: ",y),!l.ok)throw new Error(`HTTP error! status: ${l.status}, body: ${y}`);let O=l.headers.get("Content-Type");if(O&&O.includes("application/json"))try{return JSON.parse(y)}catch(f){m("Couldn't parse json, falling back to raw",f)}return y}async makeAuthorizedRequest(e,t={}){let r=c(a({"Content-Type":"application/json"},t.headers),{Authorization:await this.authHeaders()});return this.makeRequest(e,c(a({},t),{headers:r}))}makeConnectRequest(e,t={}){let r="/connect";return this.projectId&&(r+=`/${this.projectId}`),r+=e,this.makeAuthorizedRequest(r,t)}getAccounts(e={}){return this.makeConnectRequest("/accounts",{method:"GET",params:e})}getApps(e){let t={};return e!=null&&e.q&&(t.q=e.q),(e==null?void 0:e.hasActions)!=null&&(t.has_actions=e.hasActions?"1":"0"),(e==null?void 0:e.hasComponents)!=null&&(t.has_components=e.hasComponents?"1":"0"),(e==null?void 0:e.hasTriggers)!=null&&(t.has_triggers=e.hasTriggers?"1":"0"),this.addRelationOpts(t,e),this.makeAuthorizedRequest("/apps",{method:"GET",params:t})}apps(e){return this.getApps(e)}getApp(e){let t=`/apps/${e}`;return this.makeAuthorizedRequest(t,{method:"GET"})}app(e){return this.getApp(e)}getComponents(e){let t={};e!=null&&e.app&&(t.app=e.app),e!=null&&e.q&&(t.q=e.q),this.addRelationOpts(t,e,20);let r="/components";return(e==null?void 0:e.componentType)==="trigger"?r="/triggers":(e==null?void 0:e.componentType)==="action"&&(r="/actions"),this.makeConnectRequest(r,{method:"GET",params:t})}components(e){return this.getComponents(e)}getComponent(e){let{key:t}=e,r=`/components/${t}`;return this.makeConnectRequest(r,{method:"GET"})}component({key:e}){return this.getComponent({key:e})}configureComponent(e){let{userId:t,externalUserId:r=t,componentId:n}=e,o=typeof n=="object"?n.key:n,i={external_user_id:r,id:o,prop_name:e.propName,configured_props:e.configuredProps,dynamic_props_id:e.dynamicPropsId,page:e.page,prev_context:e.prevContext,query:e.query};return this.makeConnectRequest("/components/configure",{method:"POST",body:i})}componentConfigure(e){return this.configureComponent(e)}reloadComponentProps(e){let{userId:t,externalUserId:r=t,componentId:n}=e,o=typeof n=="object"?n.key:n,i={external_user_id:r,id:o,configured_props:e.configuredProps,dynamic_props_id:e.dynamicPropsId};return this.makeConnectRequest("/components/props",{method:"POST",body:i})}componentReloadProps(e){return this.reloadComponentProps(e)}runAction(e){let{userId:t,externalUserId:r=t,actionId:n}=e,o=typeof n=="object"?n.key:n,i={external_user_id:r,id:o,configured_props:e.configuredProps,dynamic_props_id:e.dynamicPropsId,stash_id:e.stashId};return this.makeConnectRequest("/actions/run",{method:"POST",body:i})}actionRun(e){return this.runAction(e)}deployTrigger(e){let{userId:t,externalUserId:r=t,triggerId:n}=e,o=typeof n=="object"?n.key:n,i={external_user_id:r,id:o,configured_props:e.configuredProps,dynamic_props_id:e.dynamicPropsId,workflow_id:e.workflowId,webhook_url:e.webhookUrl};return this.makeConnectRequest("/triggers/deploy",{method:"POST",body:i})}triggerDeploy(e){return this.deployTrigger(e)}deleteTrigger(e){let{id:t,externalUserId:r,ignoreHookErrors:n=null}=e;return this.makeConnectRequest(`/deployed-triggers/${t}`,{method:"DELETE",params:{external_user_id:r,ignore_hook_errors:n}})}getTrigger(e){let{id:t,externalUserId:r}=e;return this.makeConnectRequest(`/deployed-triggers/${t}`,{method:"GET",params:{external_user_id:r}})}getTriggers(e){let{externalUserId:t}=e;return this.makeConnectRequest("/deployed-triggers",{method:"GET",params:{external_user_id:t}})}updateTrigger(e){let{id:t,externalUserId:r,active:n=null,configuredProps:o=null,name:i=null}=e;return this.makeConnectRequest(`/deployed-triggers/${t}`,{method:"PUT",params:{external_user_id:r},body:{active:n,configured_props:o,name:i}})}getTriggerEvents(e){let{id:t,externalUserId:r,limit:n=null}=e;return this.makeConnectRequest(`/deployed-triggers/${t}/events`,{method:"GET",params:{external_user_id:r,n}})}getTriggerWorkflows(e){let{id:t,externalUserId:r}=e;return this.makeConnectRequest(`/deployed-triggers/${t}/pipelines`,{method:"GET",params:{external_user_id:r}})}updateTriggerWorkflows(e){let{id:t,externalUserId:r,workflowIds:n}=e;if(!Array.isArray(n))throw new Error("workflowIds must be an array");return this.makeConnectRequest(`/deployed-triggers/${t}/pipelines`,{method:"PUT",params:{external_user_id:r},body:{workflow_ids:n}})}getTriggerWebhooks(e){let{id:t,externalUserId:r}=e;return this.makeConnectRequest(`/deployed-triggers/${t}/webhooks`,{method:"GET",params:{external_user_id:r}})}updateTriggerWebhooks(e){let{id:t,externalUserId:r,webhookUrls:n}=e;if(!Array.isArray(n))throw new Error("webhookUrls must be an array");return this.makeConnectRequest(`/deployed-triggers/${t}/webhooks`,{method:"PUT",params:{external_user_id:r},body:{webhook_urls:n}})}buildWorkflowUrl(e){let t=e.trim().replace(/[^\w-./:]/g,"").toLowerCase();if(!t)throw new Error("URL or endpoint ID is required");let r;if(t.includes(".")||t.startsWith("http")){let o;try{let i=t.startsWith("http")?t:`https://${t}`;o=new URL(i)}catch(i){throw new Error(`
          The provided URL is malformed: "${t}".
          Please provide a valid URL.
        `)}if(!o.hostname.endsWith(this.workflowDomain))throw new Error(`Invalid workflow domain. URL must end with ${this.workflowDomain}`);r=o.href}else{if(!/^e(n|o)[a-z0-9-]+$/i.test(t))throw new Error(`
          Invalid endpoint ID format.
          Must contain only letters, numbers, and hyphens, and start with either "en" or "eo".
        `);r=`https://${t}.${this.workflowDomain}`}return r}async invokeWorkflow(e,t={},r="none"){let{body:n,headers:o={}}=t,i=this.buildWorkflowUrl(e),p;switch(r){case"static_bearer_token":p=o.Authorization;break;case"oauth":p=await this.authHeaders();break;default:break}return this.makeRequest("",c(a({},t),{baseURL:i,method:t.method||"POST",headers:p?c(a({},o),{Authorization:p}):o,body:n}))}async invokeWorkflowForExternalUser(e,t,r={}){if(!(t!=null&&t.trim()))throw new Error("External user ID is required");if(!e.trim())throw new Error("Workflow URL is required");if(!await this.authHeaders())throw new Error("OAuth or token is required for invoking workflows for external users. Please pass credentials for a valid OAuth client");let{headers:n={}}=r;return this.invokeWorkflow(e,c(a({},r),{headers:c(a({},n),{"X-PD-External-User-ID":t})}),"oauth")}addRelationOpts(e,t,r){(t==null?void 0:t.limit)!=null&&(e.limit=""+t.limit),r!=null&&!e.limit&&(e.limit=""+r),t!=null&&t.after&&(e.after=t.after),t!=null&&t.before&&(e.before=t.before)}};function N(s){return new P(s)}var P=class extends k{constructor(t){super(t);this.projectId="";this.ensureValidEnvironment(t.environment),this.projectId=t.projectId,"accessToken"in t.credentials?this.staticAccessToken=t.credentials.accessToken:this.oauthClient=this.newOauthClient(t.credentials,this.apiHost)}ensureValidEnvironment(t){if(!t||!["development","production"].includes(t))throw new Error("Project environment is required. Supported environments are development and production.")}newOauthClient({clientId:t,clientSecret:r},n){if(!t||!r)throw new Error("OAuth client ID and secret are required");let o={client_id:t},i=g.ClientSecretPost(r),p={issuer:n,token_endpoint:`https://${n}/v1/oauth/token`};return{client:o,clientAuth:i,as:p}}rawAccessToken(){return this.staticAccessToken?this.staticAccessToken:this.ensureValidOauthAccessToken()}authHeaders(){return this.staticAccessToken?`Bearer ${this.staticAccessToken}`:this.oauthAuthorizationHeader()}async ensureValidOauthAccessToken(){if(!this.oauthClient)throw new Error("OAuth client not configured");let{client:t,clientAuth:r,as:n}=this.oauthClient,o=0,i=2;for(;!this.oauthAccessToken||this.oauthAccessToken.expiresAt-Date.now()<1e3;){if(o>i)throw new Error("ran out of attempts trying to retrieve oauth access token");o>0&&await new Promise(u=>setTimeout(u,100));let p=new URLSearchParams;try{let u=await g.clientCredentialsGrantRequest(n,t,r,p),d=await g.processClientCredentialsResponse(n,t,u);this.oauthAccessToken={token:d.access_token,expiresAt:Date.now()+(d.expires_in||0)*1e3}}catch(u){}o++}return this.oauthAccessToken.token}async oauthAuthorizationHeader(){return`Bearer ${await this.ensureValidOauthAccessToken()}`}createConnectToken(t){let r=c(a({},t),{external_id:t.external_user_id});return this.makeConnectRequest("/tokens",{method:"POST",body:r})}getAccountById(t,r={}){return this.makeConnectRequest(`/accounts/${t}`,{method:"GET",params:r})}deleteAccount(t){return this.makeConnectRequest(`/accounts/${t}`,{method:"DELETE"})}deleteAccountsByApp(t){return this.makeConnectRequest(`/accounts/app/${t}`,{method:"DELETE"})}deleteExternalUser(t){return this.makeConnectRequest(`/users/${t}`,{method:"DELETE"})}getProjectInfo(){return this.makeConnectRequest("/projects/info",{method:"GET"})}makeProxyRequest(t,r){let n=btoa(r.url).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),o=r.options.headers||{},i=Object.keys(o).reduce((u,d)=>(u[`x-pd-proxy-${d}`]=o[d],u),{}),p={method:r.options.method,headers:i,params:t.searchParams};return r.options.body&&(p.body=r.options.body),this.makeConnectRequest(`/proxy/${n}`,p)}};export{D as a,S as b,m as c,k as d,N as e,P as f};
//# sourceMappingURL=chunk-6LFTWSE2.js.map