"use strict";var me=Object.defineProperty,ge=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var N=(t,e,r)=>e in t?me(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,y=(t,e)=>{for(var r in e||(e={}))Q.call(e,r)&&N(t,r,e[r]);if(C)for(var r of C(e))X.call(e,r)&&N(t,r,e[r]);return t},w=(t,e)=>ge(t,ye(e));var H=(t,e)=>{var r={};for(var n in t)Q.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&C)for(var n of C(t))e.indexOf(n)<0&&X.call(t,n)&&(r[n]=t[n]);return r};var g=(t,e,r)=>N(t,typeof e!="symbol"?e+"":e,r);var L,I,ne;(typeof navigator=="undefined"||!((ne=(I=navigator.userAgent)==null?void 0:I.startsWith)!=null&&ne.call(I,"Mozilla/5.0 ")))&&(L="oauth4webapi/v3.1.4");function z(t,e){if(t==null)return!1;try{return t instanceof e||Object.getPrototypeOf(t)[Symbol.toStringTag]===e.prototype[Symbol.toStringTag]}catch(r){return!1}}var R="ERR_INVALID_ARG_VALUE",P="ERR_INVALID_ARG_TYPE";function h(t,e,r){let n=new TypeError(t,{cause:r});return Object.assign(n,{code:e}),n}var we=Symbol(),_e=Symbol(),be=Symbol(),Re=Symbol(),Tt=Symbol(),Te=Symbol(),Pt=Symbol(),Pe=new TextEncoder,xe=new TextDecoder;function Y(t){return typeof t=="string"?Pe.encode(t):xe.decode(t)}var Z=32768;function ke(t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));let e=[];for(let r=0;r<t.byteLength;r+=Z)e.push(String.fromCharCode.apply(null,t.subarray(r,r+Z)));return btoa(e.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Se(t){try{let e=atob(t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r}catch(e){throw h("The input to be decoded is not correctly encoded.",R,e)}}function ee(t){return typeof t=="string"?Se(t):ke(t)}var k=class extends Error{constructor(r,n){var o;super(r,n);g(this,"code");this.name=this.constructor.name,this.code=rt,(o=Error.captureStackTrace)==null||o.call(Error,this,this.constructor)}},q=class extends Error{constructor(r,n){var o;super(r,n);g(this,"code");this.name=this.constructor.name,n!=null&&n.code&&(this.code=n==null?void 0:n.code),(o=Error.captureStackTrace)==null||o.call(Error,this,this.constructor)}};function u(t,e,r){return new q(t,{code:e,cause:r})}function v(t){return!(t===null||typeof t!="object"||Array.isArray(t))}function Ae(t){z(t,Headers)&&(t=Object.fromEntries(t.entries()));let e=new Headers(t);if(L&&!e.has("user-agent")&&e.set("user-agent",L),e.has("authorization"))throw h('"options.headers" must not include the "authorization" header name',R);if(e.has("dpop"))throw h('"options.headers" must not include the "dpop" header name',R);return e}function Oe(t){if(typeof t=="function"&&(t=t()),!(t instanceof AbortSignal))throw h('"options.signal" must return or be an instance of AbortSignal',P);return t}function J(t,e,r,n,o){try{if(typeof t!="number"||!Number.isFinite(t))throw h(`${r} must be a number`,P,o);if(t>0)return;throw h(e&&t!==0?`${r} must be a non-negative number`:`${r} must be a positive number`,R,o)}catch(s){throw n?u(s.message,n,o):s}}function T(t,e,r,n){try{if(typeof t!="string")throw h(`${e} must be a string`,P,n);if(t.length===0)throw h(`${e} must not be empty`,R,n)}catch(o){throw r?u(o.message,r,n):o}}function oe(t){Ce(t,"application/json")}function Ee(t,...e){let r='"response" content-type must be ';if(e.length>2){let n=e.pop();r+=`${e.join(", ")}, or ${n}`}else e.length===2?r+=`${e[0]} or ${e[1]}`:r+=e[0];return u(r,nt,t)}function Ce(t,e){if($e(t)!==e)throw Ee(t,e)}function Ie(t){let e=t==null?void 0:t[_e];return typeof e=="number"&&Number.isFinite(e)?e:0}function ve(t){let e=t==null?void 0:t[be];return typeof e=="number"&&Number.isFinite(e)&&Math.sign(e)!==-1?e:30}function Ue(){return Math.floor(Date.now()/1e3)}function se(t){if(typeof t!="object"||t===null)throw h('"as" must be an object',P);T(t.issuer,'"as.issuer"')}function ae(t){if(typeof t!="object"||t===null)throw h('"client" must be an object',P);T(t.client_id,'"client.client_id"')}function ie(t){return T(t,'"clientSecret"'),(e,r,n,o)=>{n.set("client_id",r.client_id),n.set("client_secret",t)}}var De=URL.parse?(t,e)=>URL.parse(t,e):(t,e)=>{try{return new URL(t,e)}catch(r){return null}};function je(t,e){if(e&&t.protocol!=="https:")throw u("only requests to HTTPS are allowed",st,t);if(t.protocol!=="https:"&&t.protocol!=="http:")throw u("only HTTP and HTTPS requests are allowed",at,t)}function te(t,e,r,n){let o;if(typeof t!="string"||!(o=De(t)))throw u(`authorization server metadata does not contain a valid ${r?`"as.mtls_endpoint_aliases.${e}"`:`"as.${e}"`}`,t===void 0?it:ct,{attribute:r?`mtls_endpoint_aliases.${e}`:e});return je(o,n),o}function Ne(t,e,r,n){return r&&t.mtls_endpoint_aliases&&e in t.mtls_endpoint_aliases?te(t.mtls_endpoint_aliases[e],e,r,n):te(t[e],e,r,n)}var W=class extends Error{constructor(r,n){var o;super(r,n);g(this,"cause");g(this,"code");g(this,"error");g(this,"status");g(this,"error_description");g(this,"response");this.name=this.constructor.name,this.code=tt,this.cause=n.cause,this.error=n.cause.error,this.status=n.response.status,this.error_description=n.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:n.response}),(o=Error.captureStackTrace)==null||o.call(Error,this,this.constructor)}};var G=class extends Error{constructor(r,n){var o;super(r,n);g(this,"cause");g(this,"code");g(this,"response");g(this,"status");this.name=this.constructor.name,this.code=et,this.cause=n.cause,this.status=n.response.status,this.response=n.response,Object.defineProperty(this,"response",{enumerable:!1}),(o=Error.captureStackTrace)==null||o.call(Error,this,this.constructor)}};function He(t){return t.length>=2&&t[0]==='"'&&t[t.length-1]==='"'?t.slice(1,-1):t}var Je=/((?:,|, )?[0-9a-zA-Z!#$%&'*+-.^_`|~]+=)/,Le=/(?:^|, ?)([0-9a-zA-Z!#$%&'*+\-.^_`|~]+)(?=$|[ ,])/g;function qe(t,e){let r=e.split(Je).slice(1);if(!r.length)return{scheme:t.toLowerCase(),parameters:{}};r[r.length-1]=r[r.length-1].replace(/,$/,"");let n={};for(let o=1;o<r.length;o+=2){let s=o;if(r[s][0]==='"')for(;r[s].slice(-1)!=='"'&&++o<r.length;)r[s]+=r[o];let a=r[s-1].replace(/^(?:, ?)|=$/g,"").toLowerCase();n[a]=He(r[s])}return{scheme:t.toLowerCase(),parameters:n}}function We(t){if(!z(t,Response))throw h('"response" must be an instance of Response',P);let e=t.headers.get("www-authenticate");if(e===null)return;let r=[];for(let{1:o,index:s}of e.matchAll(Le))r.push([o,s]);return r.length?r.map(([o,s],a,d)=>{let c=d[a+1],i;return c?i=e.slice(s,c[1]):i=e.slice(s),qe(o,i)}):void 0}function Ge(t){if(!Xe.has(t))throw h('"options.DPoP" is not a valid DPoPHandle',R)}var xt=Symbol();function $e(t){var e;return(e=t.headers.get("content-type"))==null?void 0:e.split(";")[0]}async function ze(t,e,r,n,o,s,a){return await r(t,e,o,s),s.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),((a==null?void 0:a[Re])||fetch)(n.href,{body:o,headers:Object.fromEntries(s.entries()),method:"POST",redirect:"manual",signal:a!=null&&a.signal?Oe(a.signal):void 0})}async function Ke(t,e,r,n,o,s){var i;let a=Ne(t,"token_endpoint",e.use_mtls_endpoint_aliases,(s==null?void 0:s[we])!==!0);o.set("grant_type",n);let d=Ae(s==null?void 0:s.headers);d.set("accept","application/json"),(s==null?void 0:s.DPoP)!==void 0&&(Ge(s.DPoP),await s.DPoP.addProof(a,d,"POST"));let c=await ze(t,e,r,a,o,d,s);return(i=s==null?void 0:s.DPoP)==null||i.cacheNonce(c),c}var Fe=new WeakMap,Ve=new WeakMap;async function Be(t,e,r,n,o){var d;if(se(t),ae(e),!z(r,Response))throw h('"response" must be an instance of Response',P);let s;if(s=We(r))throw new G("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:s,response:r});if(r.status!==200){let c;throw(c=await ut(r))?(await((d=r.body)==null?void 0:d.cancel()),new W("server responded with an error in the response body",{cause:c,response:r})):u('"response" is not a conform Token Endpoint response (unexpected HTTP status code)',ot,r)}de(r),oe(r);let a;try{a=await r.json()}catch(c){throw u('failed to parse "response" body as JSON',$,c)}if(!v(a))throw u('"response" body must be a top level object',p,{body:a});if(T(a.access_token,'"response" body "access_token" property',p,{body:a}),T(a.token_type,'"response" body "token_type" property',p,{body:a}),a.token_type=a.token_type.toLowerCase(),a.token_type!=="dpop"&&a.token_type!=="bearer")throw new k("unsupported `token_type` value",{cause:{body:a}});if(a.expires_in!==void 0){let c=typeof a.expires_in!="number"?parseFloat(a.expires_in):a.expires_in;J(c,!1,'"response" body "expires_in" property',p,{body:a}),a.expires_in=c}if(a.refresh_token!==void 0&&T(a.refresh_token,'"response" body "refresh_token" property',p,{body:a}),a.scope!==void 0&&typeof a.scope!="string")throw u('"response" body "scope" property must be a string',p,{body:a});if(a.id_token!==void 0){T(a.id_token,'"response" body "id_token" property',p,{body:a});let c=["aud","exp","iat","iss","sub"];e.require_auth_time===!0&&c.push("auth_time"),e.default_max_age!==void 0&&(J(e.default_max_age,!1,'"client.default_max_age"'),c.push("auth_time")),n!=null&&n.length&&c.push(...n);let{claims:i,jwt:_}=await dt(a.id_token,pt.bind(void 0,e.id_token_signed_response_alg,t.id_token_signing_alg_values_supported,"RS256"),Ie(e),ve(e),o==null?void 0:o[Te]).then(Ze.bind(void 0,c)).then(Qe.bind(void 0,t)).then(Me.bind(void 0,e.client_id));if(Array.isArray(i.aud)&&i.aud.length!==1){if(i.azp===void 0)throw u('ID Token "aud" (audience) claim includes additional untrusted audiences',S,{claims:i,claim:"aud"});if(i.azp!==e.client_id)throw u('unexpected ID Token "azp" (authorized party) claim value',S,{expected:e.client_id,claims:i,claim:"azp"})}i.auth_time!==void 0&&J(i.auth_time,!1,'ID Token "auth_time" (authentication time)',p,{claims:i}),Ve.set(r,_),Fe.set(a,i)}return a}function Me(t,e){if(Array.isArray(e.claims.aud)){if(!e.claims.aud.includes(t))throw u('unexpected JWT "aud" (audience) claim value',S,{expected:t,claims:e.claims,claim:"aud"})}else if(e.claims.aud!==t)throw u('unexpected JWT "aud" (audience) claim value',S,{expected:t,claims:e.claims,claim:"aud"});return e}function Qe(t,e){var n,o;let r=(o=(n=t[lt])==null?void 0:n.call(t,e))!=null?o:t.issuer;if(e.claims.iss!==r)throw u('unexpected JWT "iss" (issuer) claim value',S,{expected:r,claims:e.claims,claim:"iss"});return e}var Xe=new WeakSet;var Ye={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function Ze(t,e){for(let r of t)if(e.claims[r]===void 0)throw u(`JWT "${r}" (${Ye[r]}) claim missing`,p,{claims:e.claims});return e}var kt=Symbol(),St=Symbol();var et="OAUTH_WWW_AUTHENTICATE_CHALLENGE",tt="OAUTH_RESPONSE_BODY_ERROR",rt="OAUTH_UNSUPPORTED_OPERATION";var $="OAUTH_PARSE_ERROR",p="OAUTH_INVALID_RESPONSE";var nt="OAUTH_RESPONSE_IS_NOT_JSON",ot="OAUTH_RESPONSE_IS_NOT_CONFORM",st="OAUTH_HTTP_REQUEST_FORBIDDEN",at="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",re="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",S="OAUTH_JWT_CLAIM_COMPARISON_FAILED";var it="OAUTH_MISSING_SERVER_METADATA",ct="OAUTH_INVALID_SERVER_METADATA";async function ce(t,e,r,n,o){return se(t),ae(e),Ke(t,e,r,"client_credentials",new URLSearchParams(n),o)}async function ue(t,e,r,n){return Be(t,e,r,void 0,n)}function de(t){if(t.bodyUsed)throw h('"response" body has been used already',R)}async function ut(t){if(t.status>399&&t.status<500){de(t),oe(t);try{let e=await t.clone().json();if(v(e)&&typeof e.error=="string"&&e.error.length)return e}catch(e){}}}async function dt(t,e,r,n,o){let{0:s,1:a,length:d}=t.split(".");if(d===5)if(o!==void 0)t=await o(t),{0:s,1:a,length:d}=t.split(".");else throw new k("JWE decryption is not configured",{cause:t});if(d!==3)throw u("Invalid JWT",p,t);let c;try{c=JSON.parse(Y(ee(s)))}catch(b){throw u("failed to parse JWT Header body as base64url encoded JSON",$,b)}if(!v(c))throw u("JWT Header must be a top level object",p,t);if(e(c),c.crit!==void 0)throw new k('no JWT "crit" header parameter extensions are supported',{cause:{header:c}});let i;try{i=JSON.parse(Y(ee(a)))}catch(b){throw u("failed to parse JWT Payload body as base64url encoded JSON",$,b)}if(!v(i))throw u("JWT Payload must be a top level object",p,t);let _=Ue()+r;if(i.exp!==void 0){if(typeof i.exp!="number")throw u('unexpected JWT "exp" (expiration time) claim type',p,{claims:i});if(i.exp<=_-n)throw u('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',re,{claims:i,now:_,tolerance:n,claim:"exp"})}if(i.iat!==void 0&&typeof i.iat!="number")throw u('unexpected JWT "iat" (issued at) claim type',p,{claims:i});if(i.iss!==void 0&&typeof i.iss!="string")throw u('unexpected JWT "iss" (issuer) claim type',p,{claims:i});if(i.nbf!==void 0){if(typeof i.nbf!="number")throw u('unexpected JWT "nbf" (not before) claim type',p,{claims:i});if(i.nbf>_+n)throw u('unexpected JWT "nbf" (not before) claim value',re,{claims:i,now:_,tolerance:n,claim:"nbf"})}if(i.aud!==void 0&&typeof i.aud!="string"&&!Array.isArray(i.aud))throw u('unexpected JWT "aud" (audience) claim type',p,{claims:i});return{header:c,claims:i,jwt:t}}function pt(t,e,r,n){if(t!==void 0){if(typeof t=="string"?n.alg!==t:!t.includes(n.alg))throw u('unexpected JWT "alg" header parameter',p,{header:n,expected:t,reason:"client configuration"});return}if(Array.isArray(e)){if(!e.includes(n.alg))throw u('unexpected JWT "alg" header parameter',p,{header:n,expected:e,reason:"authorization server metadata"});return}if(r!==void 0){if(typeof r=="string"?n.alg!==r:typeof r=="function"?!r(n.alg):!r.includes(n.alg))throw u('unexpected JWT "alg" header parameter',p,{header:n,expected:r,reason:"default value"});return}throw u('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:t,issuer:e,fallback:r})}var At=Symbol(),Ot=Symbol();var Et=Symbol(),Ct=Symbol(),lt=Symbol();var K="1.6.9";var ft=["token","password","secret","apiKey","authorization","auth","key","access_token"];function F(t,e=new WeakSet){if(t==null)return t;if(typeof t=="object"){if(e.has(t))return"[CIRCULAR]";if(e.add(t),Array.isArray(t))return t.map(n=>F(n,e));let r={};for(let[n,o]of Object.entries(t)){let s=ft.some(a=>n.toLowerCase().includes(a.toLowerCase()));r[n]=s?"[REDACTED]":F(o,e)}return r}return t}function A(...t){if(typeof process!="undefined"&&typeof process.env!="undefined"&&process.env.PD_SDK_DEBUG==="true"){let e=t.map(r=>F(r));console.log("[PD_SDK_DEBUG]",...e)}}var U=class{constructor(e){this.version=K;var o;this.environment=(o=e.environment)!=null?o:"production";let{apiHost:r="api.pipedream.com",workflowDomain:n="m.pipedream.net"}=e;this.apiHost=r,this.baseApiUrl=`https://${r}/v1`,this.workflowDomain=n}getEnvironment(){return this.environment}async makeRequest(e,r={}){let M=r,{params:n,headers:o,body:s,method:a="GET",baseURL:d=this.baseApiUrl}=M,c=H(M,["params","headers","body","method","baseURL"]),i=new URL(`${d}${e}`);if(n)for(let[E,j]of Object.entries(n))j!=null&&i.searchParams.append(E,String(j));let _=w(y({},o),{"X-PD-SDK-Version":K,"X-PD-Environment":this.environment}),b=null;s&&(s instanceof FormData||s instanceof URLSearchParams||typeof s=="string"?b=s:(b=JSON.stringify(s),_["Content-Type"]=_["Content-Type"]||"application/json"));let D=y({method:a,headers:_},c);["POST","PUT","PATCH"].includes(a.toUpperCase())&&b&&(D.body=b);let x=await fetch(i.toString(),D),O=await x.text();if(A("status: ",x.status),A("url: ",i.toString()),A("requestOptions: ",D),A("rawBody: ",O),!x.ok)throw new Error(`HTTP error! status: ${x.status}, body: ${O}`);let B=x.headers.get("Content-Type");if(B&&B.includes("application/json"))try{return JSON.parse(O)}catch(E){A("Couldn't parse json, falling back to raw",E)}return O}async makeAuthorizedRequest(e,r={}){let n=w(y({"Content-Type":"application/json"},r.headers),{Authorization:await this.authHeaders()});return this.makeRequest(e,w(y({},r),{headers:n}))}makeConnectRequest(e,r={}){let n="/connect";return this.projectId&&(n+=`/${this.projectId}`),n+=e,this.makeAuthorizedRequest(n,r)}getAccounts(e={}){return this.makeConnectRequest("/accounts",{method:"GET",params:e})}getApps(e){let r={};return e!=null&&e.q&&(r.q=e.q),(e==null?void 0:e.hasActions)!=null&&(r.has_actions=e.hasActions?"1":"0"),(e==null?void 0:e.hasComponents)!=null&&(r.has_components=e.hasComponents?"1":"0"),(e==null?void 0:e.hasTriggers)!=null&&(r.has_triggers=e.hasTriggers?"1":"0"),this.addRelationOpts(r,e),this.makeAuthorizedRequest("/apps",{method:"GET",params:r})}apps(e){return this.getApps(e)}getApp(e){let r=`/apps/${e}`;return this.makeAuthorizedRequest(r,{method:"GET"})}app(e){return this.getApp(e)}getComponents(e){let r={};e!=null&&e.app&&(r.app=e.app),e!=null&&e.q&&(r.q=e.q),this.addRelationOpts(r,e,20);let n="/components";return(e==null?void 0:e.componentType)==="trigger"?n="/triggers":(e==null?void 0:e.componentType)==="action"&&(n="/actions"),this.makeConnectRequest(n,{method:"GET",params:r})}components(e){return this.getComponents(e)}getComponent(e){let{key:r}=e,n=`/components/${r}`;return this.makeConnectRequest(n,{method:"GET"})}component({key:e}){return this.getComponent({key:e})}configureComponent(e){let{userId:r,externalUserId:n=r,componentId:o}=e,s=typeof o=="object"?o.key:o,a={external_user_id:n,id:s,prop_name:e.propName,configured_props:e.configuredProps,dynamic_props_id:e.dynamicPropsId,page:e.page,prev_context:e.prevContext,query:e.query};return this.makeConnectRequest("/components/configure",{method:"POST",body:a})}componentConfigure(e){return this.configureComponent(e)}reloadComponentProps(e){let{userId:r,externalUserId:n=r,componentId:o}=e,s=typeof o=="object"?o.key:o,a={external_user_id:n,id:s,configured_props:e.configuredProps,dynamic_props_id:e.dynamicPropsId};return this.makeConnectRequest("/components/props",{method:"POST",body:a})}componentReloadProps(e){return this.reloadComponentProps(e)}runAction(e){let{userId:r,externalUserId:n=r,actionId:o}=e,s=typeof o=="object"?o.key:o,a={external_user_id:n,id:s,configured_props:e.configuredProps,dynamic_props_id:e.dynamicPropsId,stash_id:e.stashId};return this.makeConnectRequest("/actions/run",{method:"POST",body:a})}actionRun(e){return this.runAction(e)}deployTrigger(e){let{userId:r,externalUserId:n=r,triggerId:o}=e,s=typeof o=="object"?o.key:o,a={external_user_id:n,id:s,configured_props:e.configuredProps,dynamic_props_id:e.dynamicPropsId,workflow_id:e.workflowId,webhook_url:e.webhookUrl};return this.makeConnectRequest("/triggers/deploy",{method:"POST",body:a})}triggerDeploy(e){return this.deployTrigger(e)}deleteTrigger(e){let{id:r,externalUserId:n,ignoreHookErrors:o=null}=e;return this.makeConnectRequest(`/deployed-triggers/${r}`,{method:"DELETE",params:{external_user_id:n,ignore_hook_errors:o}})}getTrigger(e){let{id:r,externalUserId:n}=e;return this.makeConnectRequest(`/deployed-triggers/${r}`,{method:"GET",params:{external_user_id:n}})}getTriggers(e){let{externalUserId:r}=e;return this.makeConnectRequest("/deployed-triggers",{method:"GET",params:{external_user_id:r}})}updateTrigger(e){let{id:r,externalUserId:n,active:o=null,configuredProps:s=null,name:a=null}=e;return this.makeConnectRequest(`/deployed-triggers/${r}`,{method:"PUT",params:{external_user_id:n},body:{active:o,configured_props:s,name:a}})}getTriggerEvents(e){let{id:r,externalUserId:n,limit:o=null}=e;return this.makeConnectRequest(`/deployed-triggers/${r}/events`,{method:"GET",params:{external_user_id:n,n:o}})}getTriggerWorkflows(e){let{id:r,externalUserId:n}=e;return this.makeConnectRequest(`/deployed-triggers/${r}/pipelines`,{method:"GET",params:{external_user_id:n}})}updateTriggerWorkflows(e){let{id:r,externalUserId:n,workflowIds:o}=e;if(!Array.isArray(o))throw new Error("workflowIds must be an array");return this.makeConnectRequest(`/deployed-triggers/${r}/pipelines`,{method:"PUT",params:{external_user_id:n},body:{workflow_ids:o}})}getTriggerWebhooks(e){let{id:r,externalUserId:n}=e;return this.makeConnectRequest(`/deployed-triggers/${r}/webhooks`,{method:"GET",params:{external_user_id:n}})}updateTriggerWebhooks(e){let{id:r,externalUserId:n,webhookUrls:o}=e;if(!Array.isArray(o))throw new Error("webhookUrls must be an array");return this.makeConnectRequest(`/deployed-triggers/${r}/webhooks`,{method:"PUT",params:{external_user_id:n},body:{webhook_urls:o}})}buildWorkflowUrl(e){let r=e.trim().replace(/[^\w-./:]/g,"").toLowerCase();if(!r)throw new Error("URL or endpoint ID is required");let n;if(r.includes(".")||r.startsWith("http")){let s;try{let a=r.startsWith("http")?r:`https://${r}`;s=new URL(a)}catch(a){throw new Error(`
          The provided URL is malformed: "${r}".
          Please provide a valid URL.
        `)}if(!s.hostname.endsWith(this.workflowDomain))throw new Error(`Invalid workflow domain. URL must end with ${this.workflowDomain}`);n=s.href}else{if(!/^e(n|o)[a-z0-9-]+$/i.test(r))throw new Error(`
          Invalid endpoint ID format.
          Must contain only letters, numbers, and hyphens, and start with either "en" or "eo".
        `);n=`https://${r}.${this.workflowDomain}`}return n}async invokeWorkflow(e,r={},n="none"){let{body:o,headers:s={}}=r,a=this.buildWorkflowUrl(e),d;switch(n){case"static_bearer_token":d=s.Authorization;break;case"oauth":d=await this.authHeaders();break;default:break}return this.makeRequest("",w(y({},r),{baseURL:a,method:r.method||"POST",headers:d?w(y({},s),{Authorization:d}):s,body:o}))}async invokeWorkflowForExternalUser(e,r,n={}){if(!(r!=null&&r.trim()))throw new Error("External user ID is required");if(!e.trim())throw new Error("Workflow URL is required");if(!await this.authHeaders())throw new Error("OAuth or token is required for invoking workflows for external users. Please pass credentials for a valid OAuth client");let{headers:o={}}=n;return this.invokeWorkflow(e,w(y({},n),{headers:w(y({},o),{"X-PD-External-User-ID":r})}),"oauth")}addRelationOpts(e,r,n){(r==null?void 0:r.limit)!=null&&(e.limit=""+r.limit),n!=null&&!e.limit&&(e.limit=""+n),r!=null&&r.after&&(e.after=r.after),r!=null&&r.before&&(e.before=r.before)}};function pe(t){return new V(t)}var V=class extends U{constructor(r){super(r);this.projectId="";this.ensureValidEnvironment(r.environment),this.projectId=r.projectId,"accessToken"in r.credentials?this.staticAccessToken=r.credentials.accessToken:this.oauthClient=this.newOauthClient(r.credentials,this.apiHost)}ensureValidEnvironment(r){if(!r||!["development","production"].includes(r))throw new Error("Project environment is required. Supported environments are development and production.")}newOauthClient({clientId:r,clientSecret:n},o){if(!r||!n)throw new Error("OAuth client ID and secret are required");let s={client_id:r},a=ie(n),d={issuer:o,token_endpoint:`https://${o}/v1/oauth/token`};return{client:s,clientAuth:a,as:d}}rawAccessToken(){return this.staticAccessToken?this.staticAccessToken:this.ensureValidOauthAccessToken()}authHeaders(){return this.staticAccessToken?`Bearer ${this.staticAccessToken}`:this.oauthAuthorizationHeader()}async ensureValidOauthAccessToken(){if(!this.oauthClient)throw new Error("OAuth client not configured");let{client:r,clientAuth:n,as:o}=this.oauthClient,s=0,a=2;for(;!this.oauthAccessToken||this.oauthAccessToken.expiresAt-Date.now()<1e3;){if(s>a)throw new Error("ran out of attempts trying to retrieve oauth access token");s>0&&await new Promise(c=>setTimeout(c,100));let d=new URLSearchParams;try{let c=await ce(o,r,n,d),i=await ue(o,r,c);this.oauthAccessToken={token:i.access_token,expiresAt:Date.now()+(i.expires_in||0)*1e3}}catch(c){}s++}return this.oauthAccessToken.token}async oauthAuthorizationHeader(){return`Bearer ${await this.ensureValidOauthAccessToken()}`}createConnectToken(r){let n=w(y({},r),{external_id:r.external_user_id});return this.makeConnectRequest("/tokens",{method:"POST",body:n})}getAccountById(r,n={}){return this.makeConnectRequest(`/accounts/${r}`,{method:"GET",params:n})}deleteAccount(r){return this.makeConnectRequest(`/accounts/${r}`,{method:"DELETE"})}deleteAccountsByApp(r){return this.makeConnectRequest(`/accounts/app/${r}`,{method:"DELETE"})}deleteExternalUser(r){return this.makeConnectRequest(`/users/${r}`,{method:"DELETE"})}getProjectInfo(){return this.makeConnectRequest("/projects/info",{method:"GET"})}makeProxyRequest(r,n){let o=btoa(n.url).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),s=n.options.headers||{},a=Object.keys(s).reduce((c,i)=>(c[`x-pd-proxy-${i}`]=s[i],c),{}),d={method:n.options.method,headers:a,params:r.searchParams};return n.options.body&&(d.body=n.options.body),this.makeConnectRequest(`/proxy/${o}`,d)}};var l=require("commander"),{CLIENT_ID:le,CLIENT_SECRET:he,PROJECT_ID:fe,API_HOST:mt,ENVIRONMENT:gt}=process.env;(!le||!he||!fe)&&(console.error("Error: Missing required environment variables (CLIENT_ID, CLIENT_SECRET, PROJECT_ID)."),process.exit(1));var f=pe({credentials:{clientId:le,clientSecret:he},projectId:fe,apiHost:mt,environment:gt==="production"?"production":"development"});l.program.name("connect-cli").description("CLI for interacting with the Pipedream Connect API").version("1.0.0");var m=(t,e)=>{t instanceof Error?console.error(`${e}:`,t.message):console.error(`${e}:`,String(t))};l.program.command("list-project-info").description("List information about the project, including linked apps.").action(async()=>{try{let t=await f.getProjectInfo();console.log(JSON.stringify(t,null,2))}catch(t){m(t,"Failed to fetch project info")}});l.program.command("delete-account <accountId>").description("Delete an account by its ID.").action(async t=>{try{await f.deleteAccount(t),console.log(`Account with ID ${t} has been deleted.`)}catch(e){m(e,"Failed to delete account")}});l.program.command("delete-accounts-by-app <appId>").description("Delete all accounts associated with a specific app.").action(async t=>{try{await f.deleteAccountsByApp(t),console.log(`All accounts associated with app ID ${t} have been deleted.`)}catch(e){m(e,"Failed to delete accounts by app")}});l.program.command("delete-external-user <externalId>").description("Delete all accounts associated with a specific external ID.").action(async t=>{try{await f.deleteExternalUser(t),console.log(`All accounts associated with external ID ${t} have been deleted.`)}catch(e){m(e,"Failed to delete external user")}});l.program.command("create-connect-token <externalUserId>").description("Create a new Pipedream Connect token.").option("--success-redirect-uri <uri>","URL to redirect the user to upon successful connection").option("--error-redirect-uri <uri>","URL to redirect the user to upon failed connection").option("--webhook-uri <uri>","Webhook URI that Pipedream can invoke on success or failure of connection requests").option("--allowed-origins <origins>","Comma-separated list of allowed origins").action(async(t,e)=>{try{let r=await f.createConnectToken({external_user_id:t,success_redirect_uri:e.successRedirectUri,error_redirect_uri:e.errorRedirectUri,webhook_uri:e.webhookUri,allowed_origins:e.allowedOrigins?e.allowedOrigins.split(","):void 0});console.log(JSON.stringify(r,null,2))}catch(r){m(r,"Failed to create connect token")}});l.program.command("get-accounts").description("Retrieve the list of accounts associated with the project.").option("--include-credentials <include>","Include credentials in the response").action(async t=>{try{let e=t.includeCredentials?{include_credentials:t.includeCredentials}:{},r=await f.getAccounts(e);console.log(JSON.stringify(r,null,2))}catch(e){m(e,"Failed to fetch accounts")}});l.program.command("get-account-by-id <accountId>").description("Retrieve a specific account by ID.").action(async t=>{try{let e=await f.getAccountById(t);console.log(JSON.stringify(e,null,2))}catch(e){m(e,"Failed to fetch account by ID")}});l.program.command("list-apps").description("Retrieve the list of apps.").option("--query <query>","Query string to filter apps").action(async t=>{try{let e=await f.apps({q:t.query});console.log(JSON.stringify(e,null,2))}catch(e){m(e,"Failed to fetch apps")}});l.program.command("get-app <idOrNameSlug>").description("Retrieve a specific app by ID or name slug.").action(async t=>{try{let e=await f.app(t);console.log(JSON.stringify(e,null,2))}catch(e){m(e,"Failed to fetch app")}});l.program.command("list-components").description("Retrieve the list of components.").option("--app <app>","Filter components by app").option("--query <query>","Query string to filter components").option("--component-type <type>","Filter components by type (trigger or action)").action(async t=>{try{let e=await f.components({app:t.app,q:t.query,componentType:t.componentType});console.log(JSON.stringify(e,null,2))}catch(e){m(e,"Failed to fetch components")}});l.program.command("get-component <key>").description("Retrieve a specific component by key.").action(async t=>{try{let e=await f.component({key:t});console.log(JSON.stringify(e,null,2))}catch(e){m(e,"Failed to fetch component")}});l.program.command("configure-component").description("Configure a component.").requiredOption("--user-id <userId>","User ID").requiredOption("--component-id <componentId>","Component ID").requiredOption("--prop-name <propName>","Property name").requiredOption("--configured-props <props>","Configured properties as JSON string").option("--dynamic-props-id <id>","Dynamic properties ID").action(async t=>{try{let e=JSON.parse(t.configuredProps),r=await f.componentConfigure({userId:t.userId,componentId:t.componentId,propName:t.propName,configuredProps:e,dynamicPropsId:t.dynamicPropsId});console.log(JSON.stringify(r,null,2))}catch(e){m(e,"Failed to configure component")}});l.program.command("reload-component-props").description("Reload component properties.").requiredOption("--user-id <userId>","User ID").requiredOption("--component-id <componentId>","Component ID").requiredOption("--configured-props <props>","Configured properties as JSON string").option("--dynamic-props-id <id>","Dynamic properties ID").action(async t=>{try{let e=JSON.parse(t.configuredProps),r=await f.componentReloadProps({userId:t.userId,componentId:t.componentId,configuredProps:e,dynamicPropsId:t.dynamicPropsId});console.log(JSON.stringify(r,null,2))}catch(e){m(e,"Failed to reload component properties")}});l.program.command("run-action").description("Run an action.").requiredOption("--user-id <userId>","User ID").requiredOption("--action-id <actionId>","Action ID").requiredOption("--configured-props <props>","Configured properties as JSON string").option("--dynamic-props-id <id>","Dynamic properties ID").action(async t=>{try{let e=JSON.parse(t.configuredProps),r=await f.actionRun({userId:t.userId,actionId:t.actionId,configuredProps:e,dynamicPropsId:t.dynamicPropsId});console.log(JSON.stringify(r,null,2))}catch(e){m(e,"Failed to run action")}});l.program.parse(process.argv);
//# sourceMappingURL=cli.cjs.map